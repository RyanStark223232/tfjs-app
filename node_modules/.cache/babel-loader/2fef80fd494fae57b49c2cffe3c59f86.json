{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\wongh\\\\Documents\\\\GitHub\\\\tfjs-app\\\\src\\\\App.js\";\nimport React from \"react\";\nimport Button from '@material-ui/core/Button';\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport * as posenet from \"@tensorflow-models/posenet\";\nimport * as facemesh from \"@tensorflow-models/facemesh\"; //import * as tf from '@tensorflow/tfjs-core';\n\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand_tap, drawHand_rotate, drawHand_fist, drawHand_still, writeText, drawKeypoints, drawSkeleton, drawMesh } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\";\nimport { Line } from 'react-chartjs-2';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.sleep = milliseconds => {\n      return new Promise(resolve => setTimeout(resolve, milliseconds));\n    };\n\n    this.exportToJson = (objectData, filename) => {\n      let contentType = \"application/json;charset=utf-8;\";\n\n      if (window.navigator && window.navigator.msSaveOrOpenBlob) {\n        var blob = new Blob([decodeURIComponent(encodeURI(JSON.stringify(objectData)))], {\n          type: contentType\n        });\n        navigator.msSaveOrOpenBlob(blob, filename);\n      } else {\n        var a = document.createElement('a');\n        a.download = filename;\n        a.href = 'data:' + contentType + ',' + encodeURIComponent(JSON.stringify(objectData));\n        a.target = '_blank';\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n      }\n    };\n\n    this.getArray = () => {\n      let dict = {\n        tap_count: this.state.tap_count,\n        rotate_count: this.state.rotate_count,\n        fist_count: this.state.fist_count,\n        dist_array: this.state.dist_array,\n        dist_time_array: this.state.dist_time_array,\n        dist_record: this.state.dist_record,\n        dist_time_record: this.state.dist_time_record,\n        rotate_array: this.state.rotate_array,\n        rotate_time_array: this.state.rotate_time_array,\n        rotate_record: this.state.rotate_record,\n        rotate_time_record: this.state.rotate_time_record,\n        fist_array: this.state.fist_array,\n        fist_time_array: this.state.fist_time_array,\n        fist_record: this.state.fist_record,\n        fist_time_record: this.state.fist_time_record,\n        still_array: this.state.still_array,\n        still_time_array: this.state.still_time_array,\n        still_record: this.state.still_record,\n        still_time_record: this.state.still_time_record,\n        startAt: this.state.startAt,\n        avg_fps: this.state.avg_fps,\n        hand_dist_array: this.state.hand_dist_array,\n        hand_rotate_array: this.state.hand_rotate_array,\n        hand_fist_array: this.state.hand_fist_array,\n        hand_still_array: this.state.hand_still_array\n      };\n      this.exportToJson(dict, \"state\");\n    };\n\n    this.state = {\n      ID: 0,\n      tap_count: [],\n      rotate_count: [],\n      fist_count: [],\n      index_passed: 0,\n      min_dist: 0,\n      max_dist: 5.0,\n      rotate_passed: 0,\n      last_pressed: 0,\n      real_time_inferencing: false,\n      recording: false,\n      button_mode: false,\n      chart_ready: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false,\n      hand_dist_array: [],\n      hand_rotate_array: [],\n      hand_fist_array: [],\n      hand_still_array: [],\n      dist_array: [],\n      dist_time_array: [],\n      dist_record: [],\n      dist_time_record: [],\n      rotate_array: [],\n      rotate_time_array: [],\n      rotate_record: [],\n      rotate_time_record: [],\n      fist_array: [],\n      fist_time_array: [],\n      fist_record: [],\n      fist_time_record: [],\n      still_array: [],\n      still_time_array: [],\n      still_record: [],\n      still_time_record: [],\n      last_hand: [],\n      chart_data1: null,\n      chart_data2: null,\n      chart_data3: null,\n      chart_data4: null,\n      wait: false,\n      wait_till: 0,\n      startAt: Date.now(),\n      dead_frame: 0,\n      raw: true,\n      facingMode: \"user\",\n      avg_fps: 0\n    };\n    this.webcamRef = /*#__PURE__*/React.createRef(null);\n    this.canvasRef = /*#__PURE__*/React.createRef(null);\n    this.videoConstraints = {\n      facingMode: \"user\"\n    };\n    this.capture_interval = 50;\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_tapping = this.stop_tapping.bind(this);\n    this.stop_rotating = this.stop_rotating.bind(this);\n    this.stop_gripping = this.stop_gripping.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n    this.increment_tap1 = this.increment_tap1.bind(this);\n    this.increment_tap2 = this.increment_tap2.bind(this);\n    this.switch_button = this.switch_button.bind(this);\n    this.compose_chart = this.compose_chart.bind(this);\n    this.runPosenet = this.runPosenet.bind(this);\n    this.real_time_posenet = this.real_time_posenet.bind(this);\n    this.runFacemesh = this.runFacemesh.bind(this);\n    this.real_time_facemesh = this.real_time_facemesh.bind(this);\n    this.switch_style = this.switch_style.bind(this);\n    this.switch_cam = this.switch_cam.bind(this);\n    this.getArray = this.getArray.bind(this);\n    this.exportToJson = this.exportToJson.bind(this);\n  }\n\n  switch_cam() {\n    if (this.state.facingMode === \"user\") this.setState({\n      facingMode: \"environment\"\n    });else if (this.state.facingMode === \"environment\") this.setState({\n      facingMode: \"user\"\n    });\n  }\n\n  async runFacemesh() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await facemesh.load();\n    console.log(\"Facemesh model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.real_time_facemesh(net);\n    }, this.capture_interval);\n    this.setState({\n      ID: Interval_ID,\n      real_time_inferencing: true\n    });\n  }\n\n  async real_time_facemesh(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      });\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const face = await net.estimateFaces(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawMesh(face, ctx);\n    }\n  }\n\n  async runPosenet() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await posenet.load();\n    console.log(\"PoseNet model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.real_time_posenet(net);\n    }, this.capture_interval);\n    this.setState({\n      ID: Interval_ID,\n      real_time_inferencing: true\n    });\n  }\n\n  async real_time_posenet(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000,\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const pose = await net.estimateSinglePose(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawKeypoints(pose[\"keypoints\"], 0.6, ctx);\n      drawSkeleton(pose[\"keypoints\"], 0.7, ctx);\n    }\n  }\n\n  async switch_style() {\n    await this.setState({\n      raw: !this.state.raw\n    });\n    this.compose_chart();\n  }\n\n  compose_chart() {\n    let time_array_1 = [];\n    let count_array_1 = [];\n    let label_1 = \"\";\n    let time_array_2 = [];\n    let count_array_2 = [];\n    let label_2 = \"\";\n    let time_array_3 = [];\n    let count_array_3 = [];\n    let label_3 = \"\";\n    let time_array_4 = [];\n    let count_array_4 = [];\n    let label_4 = \"\";\n    let real_dist = document.getElementById(\"real_measurement\").value;\n    let avg_fps = this.state.dist_time_array.length / (this.state.dist_time_array[this.state.dist_time_array.length - 1] - this.state.dist_time_array[0]);\n    this.setState({\n      avg_fps: avg_fps\n    });\n\n    if (this.state.raw) {\n      // Print Data Raw\n      time_array_1 = [...this.state.dist_time_array];\n      count_array_1 = [...this.state.dist_array];\n      time_array_2 = [...this.state.rotate_time_array];\n      count_array_2 = [...this.state.rotate_array];\n      time_array_3 = [...this.state.fist_time_array];\n      count_array_3 = [...this.state.fist_array];\n\n      if (this.state.still_array.length > 100) {\n        time_array_4 = this.state.still_time_array.slice(0, this.state.still_time_array.length - 10);\n        count_array_4 = this.state.still_array.slice(0, this.state.still_array.length - 10);\n      } else {\n        time_array_4 = [...this.state.still_time_array];\n        count_array_4 = [...this.state.still_array];\n      } // Change to Real Life Measurement\n\n\n      if (real_dist > 0.0001) {\n        label_1 = \"Distance between Index and Thumb (cm)\";\n        label_2 = \"Relative Location between Left and Right of Hand (cm)\";\n        label_3 = \"Relative Location between Tip of Fingers and Finger Joints (cm)\";\n        label_4 = \"Relative Location Moved (cm)\";\n        let i = 0;\n        let tmp = 0;\n\n        for (i = 0; i < count_array_1.length; i++) {\n          tmp = count_array_1[i];\n          count_array_1[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_2.length; i++) {\n          tmp = count_array_2[i];\n          count_array_2[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_3.length; i++) {\n          tmp = count_array_3[i];\n          count_array_3[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_4.length; i++) {\n          tmp = count_array_4[i];\n          count_array_4[i] = tmp * real_dist;\n        }\n      } else {\n        label_1 = \"Distance between Index and Thumb (Relative Scale)\";\n        label_2 = \"Relative Location between Left and Right of Hand (Relative Scale)\";\n        label_3 = \"Relative Location between Tip of Fingers and Finger Joints (Relative Scale)\";\n        label_4 = \"Relative Location Moved (Relative Scale)\";\n      }\n    } else {\n      // Recalculate Tapping Data\n      let d_array = [];\n      let avg_value = 0;\n\n      for (let i = 1; i < this.state.dist_array.length; i++) d_array = [...d_array, Math.abs(this.state.dist_array[i - 1] - this.state.dist_array[i])];\n\n      for (let i = 0; i < d_array.length - 5000 / this.state.capture_interval; i++) {\n        let total = 0.0;\n\n        for (let j = 0; j < 5000 / this.state.capture_interval; j++) total += d_array[i + j]; //avg_value = (d_array[i] + d_array[i+1] + d_array[i+2] + d_array[i+3] + d_array[i+4] + d_array[i+5] + d_array[i+6] + d_array[i+7] + d_array[i+8] + d_array[i+9])/10;\n\n\n        let avg_value = total / (5000 / this.state.capture_interval);\n        count_array_1 = [...count_array_1, avg_value];\n        time_array_1 = [...time_array_1, this.state.dist_time_array[i]];\n      }\n\n      d_array = [];\n      avg_value = 0;\n\n      for (let i = 1; i < this.state.rotate_array.length; i++) d_array = [...d_array, Math.abs(this.state.rotate_array[i - 1] - this.state.rotate_array[i])];\n\n      for (let i = 0; i < d_array.length - 10; i++) {\n        avg_value = (d_array[i] + d_array[i + 1] + d_array[i + 2] + d_array[i + 3] + d_array[i + 4] + d_array[i + 5] + d_array[i + 6] + d_array[i + 7] + d_array[i + 8] + d_array[i + 9]) / 10;\n        count_array_2 = [...count_array_2, avg_value];\n        time_array_2 = [...time_array_2, this.state.rotate_time_array[i]];\n      }\n\n      d_array = [];\n      avg_value = 0;\n\n      for (let i = 1; i < this.state.fist_array.length; i++) d_array = [...d_array, Math.abs(this.state.fist_array[i - 1] - this.state.fist_array[i])];\n\n      for (let i = 0; i < d_array.length - 10; i++) {\n        avg_value = (d_array[i] + d_array[i + 1] + d_array[i + 2] + d_array[i + 3] + d_array[i + 4] + d_array[i + 5] + d_array[i + 6] + d_array[i + 7] + d_array[i + 8] + d_array[i + 9]) / 10;\n        count_array_3 = [...count_array_3, avg_value];\n        time_array_3 = [...time_array_3, this.state.fist_time_array[i]];\n      }\n\n      d_array = [];\n      avg_value = 0;\n\n      for (let i = 1; i < this.state.still_array.length; i++) d_array = [...d_array, Math.abs(this.state.still_array[i - 1] - this.state.still_array[i])];\n\n      for (let i = 0; i < d_array.length - 10; i++) {\n        avg_value = (d_array[i] + d_array[i + 1] + d_array[i + 2] + d_array[i + 3] + d_array[i + 4] + d_array[i + 5] + d_array[i + 6] + d_array[i + 7] + d_array[i + 8] + d_array[i + 9]) / 10;\n        count_array_4 = [...count_array_4, avg_value];\n        time_array_4 = [...time_array_4, this.state.fist_time_array[i]];\n      } // Change to Real Life Measurement\n\n\n      if (real_dist > 0.0001) {\n        label_1 = \"Average Distance between Index and Thumb per Second (cm)\";\n        label_2 = \"Average Distance between Left and Right of Hand per Second (cm)\";\n        label_3 = \"Average Distance Location between Tip of Fingers and Finger Joints per Second (cm)\";\n        label_4 = \"Relative Location Moved per Second (cm)\";\n        let i = 0;\n        let tmp = 0;\n\n        for (i = 0; i < count_array_1.length; i++) {\n          tmp = count_array_1[i];\n          count_array_1[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_2.length; i++) {\n          tmp = count_array_2[i];\n          count_array_2[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_3.length; i++) {\n          tmp = count_array_3[i];\n          count_array_3[i] = tmp * real_dist;\n        }\n      } else {\n        label_1 = \"Average Distance between Index and Thumb per Second (Relative Scale)\";\n        label_2 = \"Average Distance between Left and Right of Hand per Second (Relative Scale)\";\n        label_3 = \"Average Distance Location between Tip of Fingers and Finger Joints per Second (Relative Scale)\";\n        label_4 = \"Relative Location Moved per Second (Relative Scale)\";\n      }\n    } // Setup Graphs\n\n\n    const data1 = {\n      labels: time_array_1,\n      datasets: [{\n        label: label_1,\n        fill: false,\n        lineTension: 0.3,\n        backgroundColor: 'rgba(75,192,192,0.4)',\n        borderColor: 'rgba(75,192,192,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(75,192,192,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(75,192,192,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_1\n      }]\n    };\n    const data2 = {\n      labels: time_array_2,\n      datasets: [{\n        label: label_2,\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: 'rgba(192,75,192,0.4)',\n        borderColor: 'rgba(192,75,192,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(192,75,192,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(192,75,192,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_2\n      }]\n    };\n    const data3 = {\n      labels: time_array_3,\n      datasets: [{\n        label: label_3,\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: 'rgba(192,192,75,0.4)',\n        borderColor: 'rgba(192,192,75,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(192,192,75,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(192,192,75,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_3\n      }]\n    };\n    const data4 = {\n      labels: time_array_4,\n      datasets: [{\n        label: label_4,\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: 'rgba(75,192,75,0.4)',\n        borderColor: 'rgba(75,192,75,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(75,192,75,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(75,192,75,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_4\n      }]\n    };\n    this.setState({\n      chart_data1: data1\n    });\n    this.setState({\n      chart_data2: data2\n    });\n    this.setState({\n      chart_data3: data3\n    });\n    this.setState({\n      chart_data4: data4\n    });\n    this.setState({\n      chart_ready: true\n    });\n  }\n\n  switch_button() {\n    if (this.state.button_mode === true) {\n      this.setState({\n        button_mode: false\n      });\n      this.compose_chart();\n    } else {\n      this.setState({\n        button_mode: true\n      });\n    }\n  }\n\n  increment_tap1() {\n    if (this.state.last_pressed !== 1) {\n      let current_moment = (Date.now() - this.state.startAt) / 1000;\n      this.setState({\n        last_pressed: 1\n      });\n      this.setState({\n        dist_array: [...this.state.dist_array, 1.0]\n      });\n      this.setState({\n        dist_time_array: [...this.state.dist_time_array, current_moment]\n      });\n      this.setState({\n        tap_count: [...this.state.tap_count, current_moment]\n      });\n    }\n  }\n\n  increment_tap2() {\n    if (this.state.last_pressed !== 2) {\n      let current_moment = (Date.now() - this.state.startAt) / 1000;\n      this.setState({\n        last_pressed: 2\n      });\n      this.setState({\n        dist_array: [...this.state.dist_array, 1.0]\n      });\n      this.setState({\n        dist_time_array: [...this.state.dist_time_array, current_moment]\n      });\n      this.setState({\n        tap_count: [...this.state.tap_count, current_moment]\n      });\n    }\n  }\n\n  norm(lm1, lm2) {\n    return sqrt(pow(lm1[0] - lm2[0], 2) + pow(lm1[1] - lm2[1], 2));\n  }\n\n  reset_counter() {\n    clearInterval(this.state.ID);\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState({\n      ID: 0,\n      tap_count: [],\n      rotate_count: [],\n      fist_count: [],\n      index_passed: 0,\n      min_dist: 0,\n      max_dist: 5.0,\n      rotate_passed: 0,\n      last_pressed: 0,\n      real_time_inferencing: false,\n      recording: false,\n      button_mode: false,\n      chart_ready: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false,\n      hand_dist_array: [],\n      hand_rotate_array: [],\n      hand_fist_array: [],\n      hand_still_array: [],\n      dist_array: [],\n      dist_time_array: [],\n      dist_record: [],\n      dist_time_record: [],\n      rotate_array: [],\n      rotate_time_array: [],\n      rotate_record: [],\n      rotate_time_record: [],\n      fist_array: [],\n      fist_time_array: [],\n      fist_record: [],\n      fist_time_record: [],\n      still_array: [],\n      still_time_array: [],\n      still_record: [],\n      still_time_record: [],\n      chart_data1: null,\n      chart_data2: null,\n      chart_data3: null,\n      wait: false,\n      wait_till: 0,\n      startAt: Date.now(),\n      dead_frame: 0,\n      raw: true,\n      facingMode: \"user\",\n      avg_fps: 0\n    });\n  }\n\n  async runHandpose() {\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    writeText(ctx, {\n      text: 'Loading',\n      x: 180,\n      y: 70\n    });\n\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height); //const uploadJSONInput = document.getElementById('upload-json');\n    //const uploadWeightsInput = document.getElementById('upload-weights');\n    //const model = await tf.loadLayersModel(tf.io.browserFiles([uploadJSONInput.files[0], uploadWeightsInput.files[0]]));\n\n    console.log(\"Handpose model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.real_time_inference(net);\n    }, this.capture_interval);\n    this.setState({\n      ID: Interval_ID,\n      real_time_inferencing: true,\n      wait: true\n    });\n  }\n\n  async real_time_inference(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      });\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\"); //check if waiting\n\n      if (Date.now() < this.state.wait_till) {\n        if (hand.length > 0) drawHand_tap(hand, ctx); //count down 3, 2, 1\n\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, {\n          text: '1',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, {\n          text: '2',\n          x: 140,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, {\n          text: '3',\n          x: 100,\n          y: 70\n        });\n      } else {\n        if (hand.length > 0) {\n          hand.forEach(prediction => {\n            this.setState({\n              dead_frame: 0\n            });\n            const landmarks = prediction.landmarks;\n            let pawn_dist = this.norm(landmarks[0], landmarks[2]);\n            let y_dist = this.norm(landmarks[0], landmarks[12]);\n            let current_moment = (Date.now() - this.state.startAt) / 1000;\n\n            if (this.state.finger_done === false) {\n              drawHand_tap(hand, ctx); // Calculate relative distance\n\n              let index_dist = this.norm(landmarks[4], landmarks[8]);\n              let current_dist = index_dist / pawn_dist; // Record distance\n\n              this.setState({\n                dist_array: [...this.state.dist_array, current_dist],\n                dist_time_array: [...this.state.dist_time_array, current_moment],\n                hand_dist_array: [...this.state.hand_dist_array, hand]\n              }); // Perform counting\n\n              if (this.state.index_passed === 0 && current_dist - this.state.min_dist > 0.05) {\n                this.setState({\n                  index_passed: 1,\n                  max_dist: current_dist\n                });\n              }\n\n              if (this.state.index_passed === 1 && current_dist > this.state.max_dist) {\n                this.setState({\n                  max_dist: current_dist\n                });\n              }\n\n              if (this.state.index_passed === 1 && this.state.max_dist - current_dist > 0.05) {\n                this.setState({\n                  index_passed: 0,\n                  min_dist: current_dist,\n                  tap_count: [...this.state.tap_count, current_moment]\n                });\n              }\n\n              if (this.state.index_passed === 0 && current_dist < this.state.min_dist) {\n                this.setState({\n                  min_dist: current_dist\n                });\n              }\n            }\n\n            if (this.state.finger_done === true && this.state.rotate_done === false) {\n              drawHand_rotate(hand, ctx, this.state.rotate_passed); // Calculate relative distance\n\n              let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / y_dist; // Record distance\n\n              this.setState({\n                rotate_array: [...this.state.rotate_array, rotate_dist],\n                rotate_time_array: [...this.state.rotate_time_array, current_moment],\n                hand_rotate_array: [...this.state.hand_rotate_array, hand]\n              }); // Perform counting\n\n              if (this.state.rotate_passed === 0) {\n                if (rotate_dist >= 0.2) this.setState({\n                  rotate_passed: 1\n                });\n                if (rotate_dist <= -0.2) this.setState({\n                  rotate_passed: -1\n                });\n              }\n\n              if (this.state.rotate_passed === 1 && rotate_dist <= -0.2) {\n                this.setState({\n                  rotate_passed: -1\n                });\n              }\n\n              if (this.state.rotate_passed === -1 && rotate_dist >= 0.2) {\n                this.setState({\n                  rotate_passed: 1,\n                  rotate_count: [...this.state.rotate_count, current_moment]\n                });\n              }\n            }\n\n            if (this.state.rotate_done === true && this.state.fist_done === false) {\n              //console.log(this.state.fist_passed);\n              drawHand_fist(hand, ctx, this.state.fist_passed); // Calculate relative distance\n\n              let fist_dist = (landmarks[8][1] - landmarks[5][1] + (landmarks[12][1] - landmarks[9][1]) + (landmarks[16][1] - landmarks[13][1]) + (landmarks[20][1] - landmarks[17][1])) / (4 * pawn_dist); // Record distance\n\n              this.setState({\n                fist_array: [...this.state.fist_array, fist_dist],\n                fist_time_array: [...this.state.fist_time_array, current_moment],\n                hand_fist_array: [...this.state.hand_fist_array, hand]\n              }); // Perform counting\n\n              if (fist_dist >= 0.0) {\n                this.setState({\n                  fist_passed: 1\n                });\n              }\n\n              if (fist_dist < -0.4 && this.state.fist_passed === 1) {\n                this.setState({\n                  fist_passed: 0,\n                  fist_count: [...this.state.fist_count, current_moment]\n                });\n              }\n            }\n\n            if (this.state.fist_done === true) {\n              // Calculate relative distance\n              let total_move;\n\n              if (this.state.last_hand.length > 0) {\n                let i;\n                let moved = [];\n                total_move = 0.0;\n\n                for (i = 0; i < 21; i++) {\n                  let move_dist = this.norm(landmarks[i], this.state.last_hand[i]) / pawn_dist;\n                  total_move += move_dist;\n\n                  if (move_dist > 0.05) {\n                    moved = [...moved, i];\n                  }\n                }\n\n                drawHand_still(hand, ctx, moved);\n              } // Record Hand Landmarks\n\n\n              this.setState({\n                still_array: [...this.state.still_array, total_move],\n                still_time_array: [...this.state.still_time_array, current_moment],\n                hand_still_array: [...this.state.hand_still_array, hand],\n                last_hand: landmarks\n              });\n            }\n          });\n        } else {\n          // Warning message for hand off screen\n          if (this.state.dead_frame > 9) writeText(ctx, {\n            text: 'Hand Off Screen',\n            x: 180,\n            y: 70\n          });\n          this.setState({\n            dead_frame: this.state.dead_frame + 1\n          });\n        }\n      }\n    }\n  }\n\n  async stop_tapping() {\n    this.setState({\n      finger_done: true\n    });\n    this.setState({\n      wait: true\n    });\n  }\n\n  async stop_rotating() {\n    this.setState({\n      rotate_done: true\n    });\n    this.setState({\n      wait: true\n    });\n  }\n\n  async stop_gripping() {\n    this.setState({\n      fist_done: true\n    });\n    this.setState({\n      wait: true\n    });\n  }\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({\n      real_time_inferencing: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false\n    });\n    this.compose_chart();\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n  }\n\n  async record_video() {\n    this.setState({\n      startAt: Date.now()\n    });\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.concat_frame();\n    }, this.capture_interval);\n    this.setState({\n      ID: Interval_ID,\n      recording: true,\n      wait: true\n    });\n  }\n\n  async concat_frame() {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000,\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      if (Date.now() < this.state.wait_till) {\n        //console.log(\"Waiting till \", this.state.wait_till);\n        //count down 3, 2, 1\n        const ctx = this.canvasRef.current.getContext(\"2d\");\n        if (this.state.wait_till - Date.now() < 250) ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);else if (this.state.wait_till - Date.now() < 1000) writeText(ctx, {\n          text: '1',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, {\n          text: '2',\n          x: 140,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, {\n          text: '3',\n          x: 100,\n          y: 70\n        });\n      } else {\n        let current_moment = (Date.now() - this.state.startAt) / 1000;\n        const image = this.webcamRef.current.getScreenshot();\n        var img = document.createElement(\"img\");\n        img.src = image;\n\n        img.onload = function () {\n          if (this.state.finger_done === false) {\n            this.setState({\n              dist_record: [...this.state.dist_record, img],\n              dist_time_record: [...this.state.dist_time_record, current_moment]\n            });\n          } else if (this.state.finger_done === true && this.state.rotate_done === false) {\n            this.setState({\n              rotate_record: [...this.state.rotate_record, img],\n              rotate_time_record: [...this.state.rotate_time_record, current_moment]\n            });\n          } else if (this.state.rotate_done === true && this.state.fist_done === false) {\n            this.setState({\n              fist_record: [...this.state.fist_record, img],\n              fist_time_record: [...this.state.fist_time_record, current_moment]\n            });\n          }\n\n          if (this.state.fist_done === true) {\n            this.setState({\n              still_record: [...this.state.still_record, img],\n              still_time_record: [...this.state.still_time_record, current_moment]\n            });\n          }\n        }.bind(this);\n      }\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\"); // Run prediction on recorded tapping data\n\n    for (let i = 0; i < this.state.dist_record.length; i++) {\n      const hand = await net.estimateHands(this.state.dist_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          // Calculate relative distance\n          const landmarks = prediction.landmarks;\n          let index_dist = this.norm(landmarks[4], landmarks[8]);\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\n          let current_dist = index_dist / pawn_dist; // Record distance\n\n          this.setState({\n            dist_array: [...this.state.dist_array, current_dist],\n            dist_time_array: [...this.state.dist_time_array, this.state.dist_time_record[i]],\n            hand_dist_array: [...this.state.hand_dist_array, hand]\n          }); // Perform counting\n\n          if (this.state.index_passed === 0 && current_dist - this.state.min_dist > 0.05) {\n            this.setState({\n              index_passed: 1,\n              max_dist: current_dist\n            });\n          }\n\n          if (this.state.index_passed === 1 && current_dist > this.state.max_dist) {\n            this.setState({\n              max_dist: current_dist\n            });\n          }\n\n          if (this.state.index_passed === 1 && this.state.max_dist - current_dist > 0.05) {\n            this.setState({\n              index_passed: 0,\n              min_dist: current_dist,\n              tap_count: [...this.state.tap_count, this.state.dist_time_record[i]]\n            });\n          }\n\n          if (this.state.index_passed === 0 && current_dist < this.state.min_dist) {\n            this.setState({\n              min_dist: current_dist\n            });\n          } //console.log(\"INDEX COUNT:\", this.state.tap_count);\n\n        });\n      }\n    } // Run prediction on recorded rotation data\n\n\n    for (let i = 0; i < this.state.rotate_record.length; i++) {\n      const hand = await net.estimateHands(this.state.rotate_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[12]);\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist; //this.setState({pawn_rotate_array:[...this.state.pawn_rotate_array, pawn_dist]});\n\n          this.setState({\n            rotate_array: [...this.state.rotate_array, rotate_dist],\n            rotate_time_array: [...this.state.rotate_time_array, this.state.rotate_time_record[i]],\n            hand_rotate_array: [...this.state.hand_rotate_array, hand]\n          });\n\n          if (this.state.rotate_passed === 0) {\n            if (rotate_dist >= 0.2) this.setState({\n              rotate_passed: 1\n            });\n            if (rotate_dist <= -0.2) this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.2) {\n            this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.2) {\n            this.setState({\n              rotate_passed: 1,\n              rotate_count: [...this.state.rotate_count, this.state.rotate_time_record[i]]\n            });\n          } //console.log(\"ROTATE COUNT:\", this.state.rotate_count);\n\n        });\n      }\n    } // Run prediction on recorded gripping data\n\n\n    for (let i = 0; i < this.state.fist_record.length; i++) {\n      const hand = await net.estimateHands(this.state.fist_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\n          let fist_dist = (landmarks[8][1] - landmarks[5][1] + (landmarks[12][1] - landmarks[9][1]) + (landmarks[16][1] - landmarks[13][1]) + (landmarks[20][1] - landmarks[17][1])) / (4 * pawn_dist); //this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\n\n          this.setState({\n            fist_array: [...this.state.fist_array, fist_dist],\n            fist_time_array: [...this.state.fist_time_array, this.state.fist_time_record[i]],\n            hand_fist_array: [...this.state.hand_fist_array, hand]\n          });\n\n          if (fist_dist >= 0.0) {\n            this.setState({\n              fist_passed: 1\n            });\n          }\n\n          if (fist_dist < -0.4 && this.state.fist_passed === 1) {\n            this.setState({\n              fist_passed: 0\n            });\n            this.setState({\n              fist_count: [...this.state.fist_count, this.state.fist_time_record[i]]\n            });\n          } //console.log(\"FIST COUNT:\", this.state.fist_count);\n\n        });\n      }\n    } // Run prediction on recorded postural data\n\n\n    for (let i = 0; i < this.state.still_record.length; i++) {\n      const hand = await net.estimateHands(this.state.still_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\n          let total_move;\n          let i;\n          let moved = [];\n\n          if (this.state.last_hand.length > 0) {\n            total_move = 0.0;\n\n            for (i = 0; i < 21; i++) {\n              let move_dist = this.norm(landmarks[i], this.state.last_hand[i]) / pawn_dist;\n              total_move += move_dist;\n\n              if (move_dist > 0.1) {\n                moved = [...moved, i];\n              }\n            }\n          } //console.log(\"TOTAL MOVED:\", total_move);\n          //this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\n\n\n          this.setState({\n            still_array: [...this.state.still_array, total_move],\n            still_time_array: [...this.state.still_time_array, this.state.still_time_record[i]],\n            hand_still_array: [...this.state.hand_still_array, hand],\n            last_hand: landmarks\n          });\n        });\n      }\n    }\n\n    this.setState({\n      record: []\n    });\n  }\n\n  async stop_record() {\n    clearInterval(this.state.ID);\n    await this.inference();\n    this.setState({\n      recording: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false\n    });\n    this.compose_chart();\n  }\n\n  render() {\n    const videoConstraints = {\n      facingMode: this.state.facingMode\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"App-header\",\n        children: [/*#__PURE__*/_jsxDEV(Webcam, {\n          ref: this.webcamRef,\n          videoConstraints: videoConstraints,\n          style: {\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 968,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: this.canvasRef,\n          style: {\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 983,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 967,\n        columnNumber: 9\n      }, this), this.state.button_mode ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.increment_tap1,\n          id: \"button1\",\n          children: \"Index Finger\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1000,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.increment_tap2,\n          id: \"button2\",\n          children: \"Middle Finger\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1001,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 999,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1004,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [this.state.real_time_inferencing ? this.state.finger_done ? this.state.rotate_done ? this.state.fist_done ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_real_time_inference,\n          children: \"Calculate Result\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1012,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_gripping,\n          children: \"Finish Gripping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1014,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_rotating,\n          children: \"Finish Rotating\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1017,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_tapping,\n          children: \"Finish Tapping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1020,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.recording,\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.runHandpose,\n          children: \"Starting Real Time Inference\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1023,\n          columnNumber: 13\n        }, this), this.state.recording ? this.state.finger_done ? this.state.rotate_done ? this.state.fist_done ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_record,\n          children: \"Calculate Result\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1030,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_gripping,\n          children: \"Finish Gripping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1032,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_rotating,\n          children: \"Finish Rotating\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1035,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_tapping,\n          children: \"Finish Tapping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1038,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.real_time_inferencing,\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.record_video,\n          children: \"Starting Recording\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1041,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.recording || this.state.real_time_inferencing,\n          variant: \"outlined\",\n          color: \"secondary\",\n          onClick: this.reset_counter,\n          children: \"Reset All\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1044,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1007,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"h5\", {\n          children: [\"Finger Tapping Count:\", this.state.tap_count.length, \"\\xA0\\xA0\\xA0\\xA0 Rotate Count:\", this.state.rotate_count.length, \"\\xA0\\xA0\\xA0\\xA0 Gripping Count: \", this.state.fist_count.length, \"\\xA0\\xA0\\xA0\\xA0 FPS: \", this.state.avg_fps]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1049,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1048,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"small\", {\n          children: \"Enter Real Measurement (cm)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1057,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"number\",\n          id: \"real_measurement\",\n          onChange: this.compose_chart,\n          step: \"0.001\",\n          min: \"0\",\n          max: \"20\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1058,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: !this.state.chart_ready,\n          onClick: this.switch_style,\n          children: \"Switch Chart Style\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1059,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.switch_cam,\n          children: \"Switch Camera\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1060,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1056,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"small\", {\n          children: \"Experimental Features\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1063,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: this.state.recording || this.state.real_time_inferencing,\n          onClick: this.runPosenet,\n          children: \"PoseNet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1064,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: this.state.recording || this.state.real_time_inferencing,\n          onClick: this.runFacemesh,\n          children: \"Facemesh\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1065,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: this.state.recording || this.state.real_time_inferencing,\n          onClick: this.switch_button,\n          children: \"Switch On/Off Button\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1066,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1062,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [this.state.chart_ready ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1071,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data2\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1072,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data3\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1073,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data4\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1074,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1070,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1077,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"upload-json\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1080,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1079,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"upload-weights\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1083,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1082,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.getArray,\n          children: \"Get Array\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1085,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1068,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 966,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/wongh/Documents/GitHub/tfjs-app/src/App.js"],"names":["React","Button","handpose","posenet","facemesh","Webcam","drawHand_tap","drawHand_rotate","drawHand_fist","drawHand_still","writeText","drawKeypoints","drawSkeleton","drawMesh","sqrt","pow","Line","App","Component","constructor","props","sleep","milliseconds","Promise","resolve","setTimeout","exportToJson","objectData","filename","contentType","window","navigator","msSaveOrOpenBlob","blob","Blob","decodeURIComponent","encodeURI","JSON","stringify","type","a","document","createElement","download","href","encodeURIComponent","target","body","appendChild","click","removeChild","getArray","dict","tap_count","state","rotate_count","fist_count","dist_array","dist_time_array","dist_record","dist_time_record","rotate_array","rotate_time_array","rotate_record","rotate_time_record","fist_array","fist_time_array","fist_record","fist_time_record","still_array","still_time_array","still_record","still_time_record","startAt","avg_fps","hand_dist_array","hand_rotate_array","hand_fist_array","hand_still_array","ID","index_passed","min_dist","max_dist","rotate_passed","last_pressed","real_time_inferencing","recording","button_mode","chart_ready","finger_done","rotate_done","fist_done","last_hand","chart_data1","chart_data2","chart_data3","chart_data4","wait","wait_till","Date","now","dead_frame","raw","facingMode","webcamRef","createRef","canvasRef","videoConstraints","capture_interval","runHandpose","bind","stop_real_time_inference","stop_tapping","stop_rotating","stop_gripping","stop_record","record_video","concat_frame","inference","reset_counter","increment_tap1","increment_tap2","switch_button","compose_chart","runPosenet","real_time_posenet","runFacemesh","real_time_facemesh","switch_style","switch_cam","setState","require","net","load","console","log","Interval_ID","setInterval","current","video","readyState","videoWidth","videoHeight","width","height","face","estimateFaces","ctx","getContext","pose","estimateSinglePose","time_array_1","count_array_1","label_1","time_array_2","count_array_2","label_2","time_array_3","count_array_3","label_3","time_array_4","count_array_4","label_4","real_dist","getElementById","value","length","slice","i","tmp","d_array","avg_value","Math","abs","total","j","data1","labels","datasets","label","fill","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","data","data2","data3","data4","current_moment","norm","lm1","lm2","clearInterval","clearRect","text","x","y","real_time_inference","hand","estimateHands","forEach","prediction","landmarks","pawn_dist","y_dist","index_dist","current_dist","rotate_dist","fist_passed","fist_dist","total_move","moved","move_dist","image","getScreenshot","img","src","onload","record","render","position","marginLeft","marginRight","left","right","textAlign","zindex"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport Button from '@material-ui/core/Button';\r\nimport * as handpose from \"@tensorflow-models/handpose\";\r\nimport * as posenet from \"@tensorflow-models/posenet\";\r\nimport * as facemesh from \"@tensorflow-models/facemesh\";\r\n//import * as tf from '@tensorflow/tfjs-core';\r\nimport Webcam from \"react-webcam\";\r\nimport \"./App.css\";\r\nimport { drawHand_tap, drawHand_rotate, drawHand_fist, drawHand_still, writeText, drawKeypoints, drawSkeleton, drawMesh } from \"./utilities\";\r\nimport { sqrt, pow } from \"mathjs\"\r\nimport {Line} from 'react-chartjs-2';\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      ID : 0,\r\n      tap_count : [],\r\n      rotate_count : [],\r\n      fist_count : [],\r\n      index_passed : 0,\r\n      min_dist: 0,\r\n      max_dist: 5.0,\r\n      rotate_passed : 0,\r\n      last_pressed:0,\r\n      real_time_inferencing:false,\r\n      recording:false,\r\n      button_mode:false,\r\n      chart_ready:false,\r\n      finger_done : false,\r\n      rotate_done : false,\r\n      fist_done : false,\r\n      hand_dist_array : [],\r\n      hand_rotate_array : [],\r\n      hand_fist_array : [],\r\n      hand_still_array : [],\r\n      dist_array : [],\r\n      dist_time_array : [],\r\n      dist_record : [],\r\n      dist_time_record : [],\r\n      rotate_array : [],\r\n      rotate_time_array : [],\r\n      rotate_record : [],\r\n      rotate_time_record : [],\r\n      fist_array : [],\r\n      fist_time_array : [],\r\n      fist_record : [],\r\n      fist_time_record : [],\r\n      still_array : [],\r\n      still_time_array : [],\r\n      still_record : [],\r\n      still_time_record : [],\r\n      last_hand: [],\r\n      chart_data1 : null,\r\n      chart_data2 : null,\r\n      chart_data3 : null,\r\n      chart_data4 : null,\r\n      wait : false,\r\n      wait_till : 0,\r\n      startAt: Date.now(),\r\n      dead_frame: 0,\r\n      raw: true,\r\n      facingMode: \"user\",\r\n      avg_fps: 0,\r\n    };\r\n    this.webcamRef = React.createRef(null);\r\n    this.canvasRef = React.createRef(null);\r\n    this.videoConstraints = {facingMode: \"user\"};\r\n    this.capture_interval = 50;\r\n    this.runHandpose = this.runHandpose.bind(this);\r\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\r\n    this.stop_tapping = this.stop_tapping.bind(this);\r\n    this.stop_rotating = this.stop_rotating.bind(this);\r\n    this.stop_gripping = this.stop_gripping.bind(this);\r\n    this.stop_record = this.stop_record.bind(this);\r\n    this.record_video = this.record_video.bind(this);\r\n    this.concat_frame = this.concat_frame.bind(this);\r\n    this.inference = this.inference.bind(this);\r\n    this.reset_counter = this.reset_counter.bind(this);\r\n    this.increment_tap1 = this.increment_tap1.bind(this);\r\n    this.increment_tap2 = this.increment_tap2.bind(this);\r\n    this.switch_button = this.switch_button.bind(this);\r\n    this.compose_chart = this.compose_chart.bind(this);\r\n    this.runPosenet = this.runPosenet.bind(this);\r\n    this.real_time_posenet = this.real_time_posenet.bind(this);\r\n    this.runFacemesh = this.runFacemesh.bind(this);\r\n    this.real_time_facemesh = this.real_time_facemesh.bind(this);\r\n    this.switch_style = this.switch_style.bind(this);\r\n    this.switch_cam = this.switch_cam.bind(this);\r\n    this.getArray = this.getArray.bind(this);\r\n    this.exportToJson = this.exportToJson.bind(this);\r\n  }\r\n\r\n  switch_cam(){\r\n    if (this.state.facingMode === \"user\") this.setState({facingMode: \"environment\"});\r\n    else if (this.state.facingMode === \"environment\") this.setState({facingMode: \"user\"});\r\n  }\r\n\r\n  async runFacemesh(){\r\n    require('@tensorflow/tfjs-backend-webgl');\r\n    const net = await facemesh.load();\r\n    console.log(\"Facemesh model loaded.\");\r\n    this.setState({startAt:Date.now()});\r\n    const Interval_ID = setInterval(() => {\r\n      this.real_time_facemesh(net);\r\n    }, this.capture_interval);\r\n    this.setState({ID:Interval_ID,\r\n      real_time_inferencing:true});\r\n  }\r\n\r\n  async real_time_facemesh(net) {\r\n    if (this.state.wait){\r\n      this.setState({wait_till:Date.now()+3000});\r\n      this.setState({wait:false});\r\n    }\r\n    if (\r\n      typeof this.webcamRef.current !== \"undefined\" &&\r\n      this.webcamRef.current !== null &&\r\n      this.webcamRef.current.video.readyState === 4\r\n    ) {\r\n      const video = this.webcamRef.current.video;\r\n      const videoWidth = this.webcamRef.current.video.videoWidth;\r\n      const videoHeight = this.webcamRef.current.video.videoHeight;\r\n      this.webcamRef.current.video.width = videoWidth;\r\n      this.webcamRef.current.video.height = videoHeight;\r\n      this.canvasRef.current.width = videoWidth;\r\n      this.canvasRef.current.height = videoHeight;\r\n      const face = await net.estimateFaces(video);\r\n      const ctx = this.canvasRef.current.getContext(\"2d\");\r\n      drawMesh(face, ctx);\r\n    }\r\n  }\r\n\r\n  async runPosenet(){\r\n    require('@tensorflow/tfjs-backend-webgl');\r\n    const net = await posenet.load();\r\n    console.log(\"PoseNet model loaded.\");\r\n    this.setState({startAt:Date.now()});\r\n    const Interval_ID = setInterval(() => {\r\n      this.real_time_posenet(net);\r\n    }, this.capture_interval);\r\n    this.setState({ID:Interval_ID,\r\n      real_time_inferencing:true});\r\n  }\r\n\r\n  async real_time_posenet(net) {\r\n    if (this.state.wait){\r\n      this.setState({wait_till:Date.now()+3000,\r\n        wait:false});\r\n    }\r\n    if (\r\n      typeof this.webcamRef.current !== \"undefined\" &&\r\n      this.webcamRef.current !== null &&\r\n      this.webcamRef.current.video.readyState === 4\r\n    ) {\r\n      const video = this.webcamRef.current.video;\r\n      const videoWidth = this.webcamRef.current.video.videoWidth;\r\n      const videoHeight = this.webcamRef.current.video.videoHeight;\r\n      this.webcamRef.current.video.width = videoWidth;\r\n      this.webcamRef.current.video.height = videoHeight;\r\n      this.canvasRef.current.width = videoWidth;\r\n      this.canvasRef.current.height = videoHeight;\r\n      const pose = await net.estimateSinglePose(video);\r\n      const ctx = this.canvasRef.current.getContext(\"2d\");\r\n      drawKeypoints(pose[\"keypoints\"], 0.6, ctx);\r\n      drawSkeleton(pose[\"keypoints\"], 0.7, ctx);\r\n    }\r\n  }\r\n\r\n  async switch_style(){\r\n    await this.setState({raw: !this.state.raw});\r\n    this.compose_chart();\r\n  }\r\n\r\n  compose_chart(){\r\n    let time_array_1 = [];\r\n    let count_array_1 = [];\r\n    let label_1 = \"\";\r\n    let time_array_2 = [];\r\n    let count_array_2 = [];\r\n    let label_2 = \"\";\r\n    let time_array_3 = [];\r\n    let count_array_3 = [];\r\n    let label_3 = \"\";\r\n    let time_array_4 = [];\r\n    let count_array_4 = [];\r\n    let label_4 = \"\";\r\n    let real_dist = document.getElementById(\"real_measurement\").value;\r\n    let avg_fps = this.state.dist_time_array.length / \r\n                 (this.state.dist_time_array[this.state.dist_time_array.length - 1] - \r\n                  this.state.dist_time_array[0]);\r\n    this.setState({avg_fps:avg_fps});\r\n    \r\n    if (this.state.raw){\r\n      // Print Data Raw\r\n      time_array_1 = [...this.state.dist_time_array];\r\n      count_array_1 = [...this.state.dist_array];\r\n      time_array_2 = [...this.state.rotate_time_array];\r\n      count_array_2 = [...this.state.rotate_array];\r\n      time_array_3 = [...this.state.fist_time_array];\r\n      count_array_3 = [...this.state.fist_array];\r\n      if (this.state.still_array.length > 100){\r\n        time_array_4 = this.state.still_time_array.slice(0, this.state.still_time_array.length-10);\r\n        count_array_4 = this.state.still_array.slice(0, this.state.still_array.length-10);\r\n      }\r\n      else {\r\n        time_array_4 = [...this.state.still_time_array];\r\n        count_array_4 = [...this.state.still_array];\r\n      }\r\n      \r\n      \r\n      // Change to Real Life Measurement\r\n      if (real_dist > 0.0001){\r\n        label_1 = \"Distance between Index and Thumb (cm)\";\r\n        label_2 = \"Relative Location between Left and Right of Hand (cm)\";\r\n        label_3 = \"Relative Location between Tip of Fingers and Finger Joints (cm)\";\r\n        label_4 = \"Relative Location Moved (cm)\";\r\n        let i = 0;\r\n        let tmp = 0;\r\n        for (i = 0; i < count_array_1.length; i++){\r\n          tmp = count_array_1[i];\r\n          count_array_1[i] = tmp*real_dist;\r\n        }\r\n        for (i = 0; i < count_array_2.length; i++){\r\n          tmp = count_array_2[i];\r\n          count_array_2[i] = tmp*real_dist;\r\n        }\r\n        for (i = 0; i < count_array_3.length; i++){\r\n          tmp = count_array_3[i];\r\n          count_array_3[i] = tmp*real_dist;\r\n        }\r\n        for (i = 0; i < count_array_4.length; i++){\r\n          tmp = count_array_4[i];\r\n          count_array_4[i] = tmp*real_dist;\r\n        }\r\n      }\r\n      else{\r\n        label_1 = \"Distance between Index and Thumb (Relative Scale)\";\r\n        label_2 = \"Relative Location between Left and Right of Hand (Relative Scale)\";\r\n        label_3 = \"Relative Location between Tip of Fingers and Finger Joints (Relative Scale)\";\r\n        label_4 = \"Relative Location Moved (Relative Scale)\";\r\n      }\r\n    }\r\n    else{\r\n      // Recalculate Tapping Data\r\n      let d_array = [];\r\n      let avg_value = 0;\r\n      for (let i = 1; i < this.state.dist_array.length; i++) d_array = [...d_array, Math.abs(this.state.dist_array[i-1] - this.state.dist_array[i])];\r\n      for (let i = 0; i < d_array.length - (5000/this.state.capture_interval); i++){\r\n        let total = 0.0;\r\n        for (let j = 0; j < (5000/this.state.capture_interval); j++) total += d_array[i+j];\r\n        //avg_value = (d_array[i] + d_array[i+1] + d_array[i+2] + d_array[i+3] + d_array[i+4] + d_array[i+5] + d_array[i+6] + d_array[i+7] + d_array[i+8] + d_array[i+9])/10;\r\n        let avg_value = total / (5000/this.state.capture_interval);\r\n        count_array_1 = [...count_array_1, avg_value];\r\n        time_array_1 = [...time_array_1, this.state.dist_time_array[i]];\r\n      }\r\n\r\n      d_array = [];\r\n      avg_value = 0;\r\n      for (let i = 1; i < this.state.rotate_array.length; i++) d_array = [...d_array, Math.abs(this.state.rotate_array[i-1] - this.state.rotate_array[i])];\r\n      for (let i = 0; i < d_array.length - 10; i++){\r\n        avg_value = (d_array[i] + d_array[i+1] + d_array[i+2] + d_array[i+3] + d_array[i+4] + d_array[i+5] + d_array[i+6] + d_array[i+7] + d_array[i+8] + d_array[i+9])/10;\r\n        count_array_2 = [...count_array_2, avg_value];\r\n        time_array_2 = [...time_array_2, this.state.rotate_time_array[i]];\r\n      }\r\n\r\n      d_array = [];\r\n      avg_value = 0;\r\n      for (let i = 1; i < this.state.fist_array.length; i++) d_array = [...d_array, Math.abs(this.state.fist_array[i-1] - this.state.fist_array[i])];\r\n      for (let i = 0; i < d_array.length - 10; i++){\r\n        avg_value = (d_array[i] + d_array[i+1] + d_array[i+2] + d_array[i+3] + d_array[i+4] + d_array[i+5] + d_array[i+6] + d_array[i+7] + d_array[i+8] + d_array[i+9])/10;\r\n        count_array_3 = [...count_array_3, avg_value];\r\n        time_array_3 = [...time_array_3, this.state.fist_time_array[i]];\r\n      }\r\n\r\n      d_array = [];\r\n      avg_value = 0;\r\n      for (let i = 1; i < this.state.still_array.length; i++) d_array = [...d_array, Math.abs(this.state.still_array[i-1] - this.state.still_array[i])];\r\n      for (let i = 0; i < d_array.length - 10; i++){\r\n        avg_value = (d_array[i] + d_array[i+1] + d_array[i+2] + d_array[i+3] + d_array[i+4] + d_array[i+5] + d_array[i+6] + d_array[i+7] + d_array[i+8] + d_array[i+9])/10;\r\n        count_array_4 = [...count_array_4, avg_value];\r\n        time_array_4 = [...time_array_4, this.state.fist_time_array[i]];\r\n      }\r\n\r\n      // Change to Real Life Measurement\r\n      if (real_dist > 0.0001){\r\n        label_1 = \"Average Distance between Index and Thumb per Second (cm)\";\r\n        label_2 = \"Average Distance between Left and Right of Hand per Second (cm)\";\r\n        label_3 = \"Average Distance Location between Tip of Fingers and Finger Joints per Second (cm)\";\r\n        label_4 = \"Relative Location Moved per Second (cm)\";\r\n        let i = 0;\r\n        let tmp = 0;\r\n        for (i = 0; i < count_array_1.length; i++){\r\n          tmp = count_array_1[i];\r\n          count_array_1[i] = tmp*real_dist;\r\n        }\r\n        for (i = 0; i < count_array_2.length; i++){\r\n          tmp = count_array_2[i];\r\n          count_array_2[i] = tmp*real_dist;\r\n        }\r\n        for (i = 0; i < count_array_3.length; i++){\r\n          tmp = count_array_3[i];\r\n          count_array_3[i] = tmp*real_dist;\r\n        }\r\n      }\r\n      else{\r\n        label_1 = \"Average Distance between Index and Thumb per Second (Relative Scale)\";\r\n        label_2 = \"Average Distance between Left and Right of Hand per Second (Relative Scale)\";\r\n        label_3 = \"Average Distance Location between Tip of Fingers and Finger Joints per Second (Relative Scale)\";\r\n        label_4 = \"Relative Location Moved per Second (Relative Scale)\";\r\n      }\r\n    }\r\n\r\n    // Setup Graphs\r\n    const data1 = {\r\n      labels: time_array_1,\r\n      datasets: [        \r\n        {\r\n          label: label_1,\r\n          fill: false,\r\n          lineTension: 0.3,\r\n          backgroundColor: 'rgba(75,192,192,0.4)',\r\n          borderColor: 'rgba(75,192,192,1)',\r\n          borderCapStyle: 'butt',\r\n          borderDash: [],\r\n          borderDashOffset: 0.0,\r\n          borderJoinStyle: 'miter',\r\n          pointBorderColor: 'rgba(75,192,192,1)',\r\n          pointBackgroundColor: '#fff',\r\n          pointBorderWidth: 1,\r\n          pointHoverRadius: 5,\r\n          pointHoverBackgroundColor: 'rgba(75,192,192,1)',\r\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n          pointHoverBorderWidth: 2,\r\n          pointRadius: 1,\r\n          pointHitRadius: 10,\r\n          data: count_array_1\r\n        }\r\n      ]\r\n    };\r\n    const data2 = {\r\n      labels: time_array_2,\r\n      datasets: [        \r\n        {\r\n          label: label_2,\r\n          fill: false,\r\n          lineTension: 0.1,\r\n          backgroundColor: 'rgba(192,75,192,0.4)',\r\n          borderColor: 'rgba(192,75,192,1)',\r\n          borderCapStyle: 'butt',\r\n          borderDash: [],\r\n          borderDashOffset: 0.0,\r\n          borderJoinStyle: 'miter',\r\n          pointBorderColor: 'rgba(192,75,192,1)',\r\n          pointBackgroundColor: '#fff',\r\n          pointBorderWidth: 1,\r\n          pointHoverRadius: 5,\r\n          pointHoverBackgroundColor: 'rgba(192,75,192,1)',\r\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n          pointHoverBorderWidth: 2,\r\n          pointRadius: 1,\r\n          pointHitRadius: 10,\r\n          data: count_array_2 \r\n        },\r\n      ]\r\n    };\r\n    const data3 = {\r\n      labels: time_array_3,\r\n      datasets: [        \r\n        {\r\n          label: label_3,\r\n          fill: false,\r\n          lineTension: 0.1,\r\n          backgroundColor: 'rgba(192,192,75,0.4)',\r\n          borderColor: 'rgba(192,192,75,1)',\r\n          borderCapStyle: 'butt',\r\n          borderDash: [],\r\n          borderDashOffset: 0.0,\r\n          borderJoinStyle: 'miter',\r\n          pointBorderColor: 'rgba(192,192,75,1)',\r\n          pointBackgroundColor: '#fff',\r\n          pointBorderWidth: 1,\r\n          pointHoverRadius: 5,\r\n          pointHoverBackgroundColor: 'rgba(192,192,75,1)',\r\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n          pointHoverBorderWidth: 2,\r\n          pointRadius: 1,\r\n          pointHitRadius: 10,\r\n          data: count_array_3\r\n        }\r\n      ]\r\n    };\r\n    const data4 = {\r\n      labels: time_array_4,\r\n      datasets: [        \r\n        {\r\n          label: label_4,\r\n          fill: false,\r\n          lineTension: 0.1,\r\n          backgroundColor: 'rgba(75,192,75,0.4)',\r\n          borderColor: 'rgba(75,192,75,1)',\r\n          borderCapStyle: 'butt',\r\n          borderDash: [],\r\n          borderDashOffset: 0.0,\r\n          borderJoinStyle: 'miter',\r\n          pointBorderColor: 'rgba(75,192,75,1)',\r\n          pointBackgroundColor: '#fff',\r\n          pointBorderWidth: 1,\r\n          pointHoverRadius: 5,\r\n          pointHoverBackgroundColor: 'rgba(75,192,75,1)',\r\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n          pointHoverBorderWidth: 2,\r\n          pointRadius: 1,\r\n          pointHitRadius: 10,\r\n          data: count_array_4\r\n        }\r\n      ]\r\n    };\r\n    this.setState({chart_data1:data1});\r\n    this.setState({chart_data2:data2});\r\n    this.setState({chart_data3:data3});\r\n    this.setState({chart_data4:data4});\r\n    this.setState({chart_ready:true});\r\n  }\r\n\r\n  switch_button(){\r\n    if (this.state.button_mode === true){\r\n      this.setState({button_mode:false});\r\n      this.compose_chart();\r\n    }\r\n    else{\r\n      this.setState({button_mode:true})\r\n    }\r\n  }\r\n\r\n  increment_tap1(){\r\n    if (this.state.last_pressed !== 1){\r\n      let current_moment = (Date.now() - this.state.startAt)/1000\r\n      this.setState({last_pressed:1})\r\n      this.setState({dist_array:[...this.state.dist_array, 1.0]});\r\n      this.setState({dist_time_array:[...this.state.dist_time_array, current_moment]});\r\n      this.setState({tap_count:[...this.state.tap_count, current_moment]});\r\n    }\r\n  }\r\n\r\n  increment_tap2(){\r\n    if (this.state.last_pressed !== 2){\r\n      let current_moment = (Date.now() - this.state.startAt)/1000\r\n      this.setState({last_pressed:2})\r\n      this.setState({dist_array:[...this.state.dist_array, 1.0]});\r\n      this.setState({dist_time_array:[...this.state.dist_time_array, current_moment]});\r\n      this.setState({tap_count:[...this.state.tap_count, current_moment]});\r\n    }\r\n  }\r\n\r\n  norm(lm1, lm2){\r\n    return sqrt(pow(lm1[0]-lm2[0], 2)+pow(lm1[1]-lm2[1], 2))\r\n  }\r\n\r\n  reset_counter(){\r\n    clearInterval(this.state.ID);\r\n    const ctx = this.canvasRef.current.getContext(\"2d\");\r\n    ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\r\n    this.setState({\r\n      ID : 0,\r\n      tap_count : [],\r\n      rotate_count : [],\r\n      fist_count : [],\r\n      index_passed : 0,\r\n      min_dist: 0,\r\n      max_dist: 5.0,\r\n      rotate_passed : 0,\r\n      last_pressed:0,\r\n      real_time_inferencing:false,\r\n      recording:false,\r\n      button_mode:false,\r\n      chart_ready:false,\r\n      finger_done : false,\r\n      rotate_done : false,\r\n      fist_done : false,\r\n      hand_dist_array : [],\r\n      hand_rotate_array : [],\r\n      hand_fist_array : [],\r\n      hand_still_array : [],\r\n      dist_array : [],\r\n      dist_time_array : [],\r\n      dist_record : [],\r\n      dist_time_record : [],\r\n      rotate_array : [],\r\n      rotate_time_array : [],\r\n      rotate_record : [],\r\n      rotate_time_record : [],\r\n      fist_array : [],\r\n      fist_time_array : [],\r\n      fist_record : [],\r\n      fist_time_record : [],\r\n      still_array : [],\r\n      still_time_array : [],\r\n      still_record : [],\r\n      still_time_record : [],\r\n      chart_data1 : null,\r\n      chart_data2 : null,\r\n      chart_data3 : null,\r\n      wait : false,\r\n      wait_till : 0,\r\n      startAt: Date.now(),\r\n      dead_frame: 0,\r\n      raw: true,\r\n      facingMode: \"user\",\r\n      avg_fps: 0,\r\n    });\r\n  }\r\n\r\n  sleep = (milliseconds) => {\r\n    return new Promise(resolve => setTimeout(resolve, milliseconds))\r\n  }\r\n\r\n  async runHandpose() {\r\n    const ctx = this.canvasRef.current.getContext(\"2d\");\r\n    writeText(ctx, { text: 'Loading', x: 180, y: 70 });\r\n    require('@tensorflow/tfjs-backend-webgl');\r\n    const net = await handpose.load();\r\n    ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\r\n    //const uploadJSONInput = document.getElementById('upload-json');\r\n    //const uploadWeightsInput = document.getElementById('upload-weights');\r\n    //const model = await tf.loadLayersModel(tf.io.browserFiles([uploadJSONInput.files[0], uploadWeightsInput.files[0]]));\r\n    console.log(\"Handpose model loaded.\");\r\n    this.setState({startAt:Date.now()});\r\n    const Interval_ID = setInterval(() => {\r\n      this.real_time_inference(net);\r\n    }, this.capture_interval);\r\n    this.setState({ID:Interval_ID,\r\n      real_time_inferencing:true,\r\n      wait:true});\r\n  };\r\n\r\n  async real_time_inference(net) {\r\n    if (this.state.wait){\r\n      this.setState({wait_till:Date.now()+3000});\r\n      this.setState({wait:false});\r\n    }\r\n    if (\r\n      typeof this.webcamRef.current !== \"undefined\" &&\r\n      this.webcamRef.current !== null &&\r\n      this.webcamRef.current.video.readyState === 4\r\n    ) {\r\n      const video = this.webcamRef.current.video;\r\n      const videoWidth = this.webcamRef.current.video.videoWidth;\r\n      const videoHeight = this.webcamRef.current.video.videoHeight;\r\n      this.webcamRef.current.video.width = videoWidth;\r\n      this.webcamRef.current.video.height = videoHeight;\r\n      this.canvasRef.current.width = videoWidth;\r\n      this.canvasRef.current.height = videoHeight;\r\n      const hand = await net.estimateHands(video);\r\n      const ctx = this.canvasRef.current.getContext(\"2d\");\r\n      \r\n      //check if waiting\r\n      if (Date.now() < this.state.wait_till){\r\n        if (hand.length > 0) drawHand_tap (hand, ctx);\r\n        \r\n        //count down 3, 2, 1\r\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, { text: '1', x: 180, y: 70 });\r\n        else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, { text: '2', x: 140, y: 70 });\r\n        else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, { text: '3', x: 100, y: 70 });\r\n      }\r\n      else {\r\n        if (hand.length > 0){\r\n          hand.forEach((prediction) => {\r\n            this.setState({dead_frame: 0});\r\n            const landmarks = prediction.landmarks\r\n\r\n            let pawn_dist = this.norm(landmarks[0], landmarks[2]);\r\n            let y_dist = this.norm(landmarks[0], landmarks[12]);\r\n            let current_moment = (Date.now() - this.state.startAt)/1000\r\n\r\n            if (this.state.finger_done === false){\r\n              drawHand_tap (hand, ctx);\r\n              // Calculate relative distance\r\n              let index_dist = this.norm(landmarks[4], landmarks[8]);\r\n              let current_dist = index_dist/pawn_dist;\r\n\r\n              // Record distance\r\n              this.setState({dist_array:[...this.state.dist_array, current_dist],\r\n                dist_time_array:[...this.state.dist_time_array, current_moment],\r\n                hand_dist_array:[...this.state.hand_dist_array, hand]});\r\n              \r\n              // Perform counting\r\n              if (this.state.index_passed === 0 && (current_dist - this.state.min_dist) > 0.05){\r\n                this.setState({index_passed:1,\r\n                  max_dist: current_dist});\r\n              }\r\n              if (this.state.index_passed === 1 && current_dist > this.state.max_dist){\r\n                this.setState({max_dist: current_dist});\r\n              }\r\n              if (this.state.index_passed === 1 && (this.state.max_dist - current_dist) > 0.05){\r\n                this.setState({index_passed:0,\r\n                  min_dist: current_dist,\r\n                  tap_count:[...this.state.tap_count, current_moment]});\r\n              }\r\n              if (this.state.index_passed === 0 && current_dist < this.state.min_dist){\r\n                this.setState({min_dist: current_dist});\r\n              }\r\n            }\r\n            \r\n            if (this.state.finger_done === true && this.state.rotate_done === false){\r\n              drawHand_rotate (hand, ctx, this.state.rotate_passed);\r\n              // Calculate relative distance\r\n              let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / y_dist;\r\n\r\n              // Record distance\r\n              this.setState({rotate_array:[...this.state.rotate_array, rotate_dist],\r\n                rotate_time_array:[...this.state.rotate_time_array, current_moment],\r\n                hand_rotate_array:[...this.state.hand_rotate_array, hand]});\r\n\r\n              // Perform counting\r\n              if (this.state.rotate_passed === 0){\r\n                if (rotate_dist >= 0.2) this.setState({rotate_passed:1});\r\n                if (rotate_dist <= -0.2) this.setState({rotate_passed:-1});\r\n              }\r\n              if (this.state.rotate_passed === 1 && rotate_dist <= -0.2){\r\n                this.setState({rotate_passed:-1});\r\n              }\r\n              if (this.state.rotate_passed === -1 && rotate_dist >= 0.2){\r\n                this.setState({rotate_passed:1,\r\n                  rotate_count:[...this.state.rotate_count, current_moment]});\r\n              }\r\n            }\r\n\r\n            if (this.state.rotate_done === true && this.state.fist_done === false){\r\n              //console.log(this.state.fist_passed);\r\n              drawHand_fist (hand, ctx, this.state.fist_passed);\r\n              // Calculate relative distance\r\n              let fist_dist =  ((landmarks[8][1] - landmarks[5][1])+\r\n                                (landmarks[12][1] - landmarks[9][1])+\r\n                                (landmarks[16][1] - landmarks[13][1])+\r\n                                (landmarks[20][1] - landmarks[17][1]))/\r\n                                (4*pawn_dist)\r\n\r\n              // Record distance\r\n              this.setState({fist_array:[...this.state.fist_array, fist_dist],\r\n                fist_time_array:[...this.state.fist_time_array, current_moment],\r\n                hand_fist_array:[...this.state.hand_fist_array, hand]});\r\n\r\n              // Perform counting\r\n              if (fist_dist >= 0.0){this.setState({fist_passed:1})}\r\n              if (fist_dist < -0.4 && this.state.fist_passed === 1){\r\n                this.setState({fist_passed:0,\r\n                  fist_count:[...this.state.fist_count, current_moment]});\r\n              }\r\n            }\r\n            \r\n            if (this.state.fist_done === true ){\r\n              // Calculate relative distance\r\n              let total_move;\r\n              if (this.state.last_hand.length > 0){\r\n                let i;\r\n                let moved = [];\r\n                total_move = 0.0;\r\n                for (i = 0; i < 21; i++){\r\n                  let move_dist = this.norm(landmarks[i], this.state.last_hand[i]) / pawn_dist;\r\n                  total_move += move_dist;\r\n                  if ( move_dist > 0.05){\r\n                    moved = [...moved, i];\r\n                  }\r\n                }\r\n                drawHand_still (hand, ctx, moved);\r\n              }\r\n\r\n              // Record Hand Landmarks\r\n              this.setState({still_array:[...this.state.still_array, total_move],\r\n                still_time_array:[...this.state.still_time_array, current_moment],\r\n                hand_still_array:[...this.state.hand_still_array, hand],\r\n                last_hand: landmarks,\r\n              });\r\n            }\r\n\r\n          });\r\n        }\r\n        else {\r\n          // Warning message for hand off screen\r\n          if (this.state.dead_frame > 9) writeText(ctx, { text: 'Hand Off Screen', x: 180, y: 70 });\r\n          this.setState({dead_frame: this.state.dead_frame + 1});\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  async stop_tapping() {\r\n    this.setState({finger_done:true});\r\n    this.setState({wait:true});\r\n  }\r\n\r\n  async stop_rotating() {\r\n    this.setState({rotate_done:true});\r\n    this.setState({wait:true});\r\n  }\r\n\r\n  async stop_gripping() {\r\n    this.setState({fist_done:true});\r\n    this.setState({wait:true});\r\n  }\r\n\r\n  stop_real_time_inference() {\r\n    clearInterval(this.state.ID);\r\n    this.setState({real_time_inferencing:false,\r\n                   finger_done:false,\r\n                   rotate_done:false,\r\n                   fist_done:false});\r\n    this.compose_chart();\r\n    const ctx = this.canvasRef.current.getContext(\"2d\");\r\n    ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\r\n  }\r\n\r\n  async record_video(){\r\n    this.setState({startAt:Date.now()});\r\n    console.log(\"Handpose model loaded.\");\r\n    const Interval_ID = setInterval(() => {\r\n      this.concat_frame();\r\n    }, this.capture_interval);\r\n    this.setState({ID:Interval_ID,\r\n      recording:true,\r\n      wait:true});\r\n  }\r\n\r\n  async concat_frame() {\r\n    if (this.state.wait){\r\n      this.setState({wait_till:Date.now()+3000,\r\n        wait:false});\r\n    }\r\n    if (\r\n      typeof this.webcamRef.current !== \"undefined\" &&\r\n      this.webcamRef.current !== null &&\r\n      this.webcamRef.current.video.readyState === 4\r\n    ) {\r\n      if (Date.now() < this.state.wait_till){\r\n        //console.log(\"Waiting till \", this.state.wait_till);\r\n        //count down 3, 2, 1\r\n        const ctx = this.canvasRef.current.getContext(\"2d\");\r\n        if (this.state.wait_till - Date.now() < 250) ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\r\n        else if (this.state.wait_till - Date.now() < 1000) writeText(ctx, { text: '1', x: 180, y: 70 });\r\n        else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, { text: '2', x: 140, y: 70 });\r\n        else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, { text: '3', x: 100, y: 70 });\r\n      }\r\n      else {\r\n        let current_moment = (Date.now() - this.state.startAt)/1000;\r\n        const image = this.webcamRef.current.getScreenshot();      \r\n        var img = document.createElement(\"img\");\r\n        img.src = image;\r\n        img.onload = function(){\r\n          if (this.state.finger_done === false){\r\n            this.setState({dist_record:[...this.state.dist_record, img],\r\n              dist_time_record:[...this.state.dist_time_record, current_moment]});\r\n          }\r\n\r\n          else if (this.state.finger_done === true && this.state.rotate_done === false){\r\n            this.setState({rotate_record:[...this.state.rotate_record, img],\r\n              rotate_time_record:[...this.state.rotate_time_record, current_moment]});\r\n          }\r\n\r\n          else if (this.state.rotate_done === true && this.state.fist_done === false){\r\n            this.setState({fist_record:[...this.state.fist_record, img],\r\n              fist_time_record:[...this.state.fist_time_record, current_moment]});\r\n          }\r\n\r\n          if (this.state.fist_done === true ){\r\n            this.setState({still_record:[...this.state.still_record, img],\r\n              still_time_record:[...this.state.still_time_record, current_moment]});\r\n          }\r\n        }.bind(this)\r\n      }\r\n    }\r\n  }\r\n\r\n  async inference() {\r\n    require('@tensorflow/tfjs-backend-webgl');\r\n    const net = await handpose.load();\r\n    console.log(\"Handpose model loaded.\");\r\n\r\n    // Run prediction on recorded tapping data\r\n    for (let i = 0; i<this.state.dist_record.length; i++){\r\n      const hand = await net.estimateHands(this.state.dist_record[i]);\r\n      if (hand.length > 0){\r\n        hand.forEach((prediction) => { \r\n          // Calculate relative distance\r\n          const landmarks = prediction.landmarks\r\n          let index_dist = this.norm(landmarks[4], landmarks[8]);\r\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\r\n          let current_dist = index_dist/pawn_dist;\r\n\r\n          // Record distance\r\n          this.setState({dist_array:[...this.state.dist_array, current_dist],\r\n            dist_time_array:[...this.state.dist_time_array, this.state.dist_time_record[i]],\r\n            hand_dist_array:[...this.state.hand_dist_array, hand]});\r\n          \r\n          // Perform counting\r\n          if (this.state.index_passed === 0 && (current_dist - this.state.min_dist) > 0.05){\r\n            this.setState({index_passed:1,\r\n              max_dist: current_dist});\r\n          }\r\n          if (this.state.index_passed === 1 && current_dist > this.state.max_dist){\r\n            this.setState({max_dist: current_dist});\r\n          }\r\n          if (this.state.index_passed === 1 && (this.state.max_dist - current_dist) > 0.05){\r\n            this.setState({index_passed:0,\r\n              min_dist: current_dist,\r\n              tap_count:[...this.state.tap_count, this.state.dist_time_record[i]]});\r\n          }\r\n          if (this.state.index_passed === 0 && current_dist < this.state.min_dist){\r\n            this.setState({min_dist: current_dist});\r\n          }\r\n          //console.log(\"INDEX COUNT:\", this.state.tap_count);\r\n        });\r\n      }\r\n    }\r\n\r\n    // Run prediction on recorded rotation data\r\n    for (let i = 0; i<this.state.rotate_record.length; i++){\r\n      const hand = await net.estimateHands(this.state.rotate_record[i]);\r\n      if (hand.length > 0){\r\n        hand.forEach((prediction) => {\r\n          const landmarks = prediction.landmarks\r\n          let pawn_dist = this.norm(landmarks[0], landmarks[12]);\r\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\r\n          //this.setState({pawn_rotate_array:[...this.state.pawn_rotate_array, pawn_dist]});\r\n          this.setState({rotate_array:[...this.state.rotate_array, rotate_dist],\r\n            rotate_time_array:[...this.state.rotate_time_array, this.state.rotate_time_record[i]],\r\n            hand_rotate_array:[...this.state.hand_rotate_array, hand]});\r\n          if (this.state.rotate_passed === 0){\r\n            if (rotate_dist >= 0.2) this.setState({rotate_passed:1});\r\n            if (rotate_dist <= -0.2) this.setState({rotate_passed:-1});\r\n          }\r\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.2){\r\n            this.setState({rotate_passed:-1});\r\n          }\r\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.2){\r\n            this.setState({rotate_passed:1, \r\n              rotate_count:[...this.state.rotate_count, this.state.rotate_time_record[i]]});\r\n          }\r\n          //console.log(\"ROTATE COUNT:\", this.state.rotate_count);\r\n        });\r\n      }\r\n    }\r\n\r\n    // Run prediction on recorded gripping data\r\n    for (let i = 0; i<this.state.fist_record.length; i++){\r\n      const hand = await net.estimateHands(this.state.fist_record[i]);\r\n      if (hand.length > 0){\r\n        hand.forEach((prediction) => {\r\n          const landmarks = prediction.landmarks\r\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\r\n          let fist_dist =  ((landmarks[8][1] - landmarks[5][1])+\r\n            (landmarks[12][1] - landmarks[9][1])+\r\n            (landmarks[16][1] - landmarks[13][1])+\r\n            (landmarks[20][1] - landmarks[17][1]))/\r\n            (4*pawn_dist)\r\n          //this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\r\n          this.setState({fist_array:[...this.state.fist_array, fist_dist],\r\n            fist_time_array:[...this.state.fist_time_array, this.state.fist_time_record[i]],\r\n            hand_fist_array:[...this.state.hand_fist_array, hand]});\r\n          if (fist_dist >= 0.0){this.setState({fist_passed:1})}\r\n          if (fist_dist < -0.4 && this.state.fist_passed === 1){\r\n            this.setState({fist_passed:0});\r\n            this.setState({fist_count:[...this.state.fist_count, this.state.fist_time_record[i]]});\r\n          }\r\n          //console.log(\"FIST COUNT:\", this.state.fist_count);\r\n        });\r\n      }\r\n    }\r\n\r\n    // Run prediction on recorded postural data\r\n    for (let i = 0; i<this.state.still_record.length; i++){\r\n      const hand = await net.estimateHands(this.state.still_record[i]);\r\n      if (hand.length > 0){\r\n        hand.forEach((prediction) => {\r\n          const landmarks = prediction.landmarks\r\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]);\r\n          let total_move;\r\n          let i;\r\n          let moved = [];\r\n          if (this.state.last_hand.length > 0){\r\n            total_move = 0.0;\r\n            for (i = 0; i < 21; i++){\r\n              let move_dist = this.norm(landmarks[i], this.state.last_hand[i]) / pawn_dist;\r\n              total_move += move_dist;\r\n              if ( move_dist > 0.1){\r\n                moved = [...moved, i];\r\n              }\r\n            }\r\n          }\r\n          //console.log(\"TOTAL MOVED:\", total_move);\r\n          //this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\r\n          this.setState({still_array:[...this.state.still_array, total_move],\r\n            still_time_array:[...this.state.still_time_array, this.state.still_time_record[i]],\r\n            hand_still_array:[...this.state.hand_still_array, hand],\r\n            last_hand: landmarks,\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    this.setState({record:[]});\r\n  }\r\n\r\n  async stop_record() {\r\n    clearInterval(this.state.ID);\r\n    await this.inference();\r\n    this.setState({recording:false,\r\n      finger_done:false,\r\n      rotate_done:false,\r\n      fist_done:false});\r\n    this.compose_chart();\r\n  }\r\n\r\n  exportToJson = (objectData, filename) => {\r\n    let contentType = \"application/json;charset=utf-8;\";\r\n    if (window.navigator && window.navigator.msSaveOrOpenBlob) {\r\n      var blob = new Blob([decodeURIComponent(encodeURI(JSON.stringify(objectData)))], { type: contentType });\r\n      navigator.msSaveOrOpenBlob(blob, filename);\r\n    } else {\r\n      var a = document.createElement('a');\r\n      a.download = filename;\r\n      a.href = 'data:' + contentType + ',' + encodeURIComponent(JSON.stringify(objectData));\r\n      a.target = '_blank';\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n    }\r\n  }\r\n \r\n  getArray = () => {\r\n    let dict = {\r\n      tap_count : this.state.tap_count,\r\n      rotate_count : this.state.rotate_count,\r\n      fist_count : this.state.fist_count,\r\n      dist_array : this.state.dist_array,\r\n      dist_time_array : this.state.dist_time_array,\r\n      dist_record : this.state.dist_record,\r\n      dist_time_record : this.state.dist_time_record,\r\n      rotate_array : this.state.rotate_array,\r\n      rotate_time_array : this.state.rotate_time_array,\r\n      rotate_record : this.state.rotate_record,\r\n      rotate_time_record : this.state.rotate_time_record,\r\n      fist_array : this.state.fist_array,\r\n      fist_time_array : this.state.fist_time_array,\r\n      fist_record : this.state.fist_record,\r\n      fist_time_record : this.state.fist_time_record,\r\n      still_array : this.state.still_array,\r\n      still_time_array : this.state.still_time_array,\r\n      still_record : this.state.still_record,\r\n      still_time_record : this.state.still_time_record,\r\n      startAt: this.state.startAt,\r\n      avg_fps: this.state.avg_fps,\r\n      hand_dist_array : this.state.hand_dist_array,\r\n      hand_rotate_array : this.state.hand_rotate_array,\r\n      hand_fist_array : this.state.hand_fist_array,\r\n      hand_still_array : this.state.hand_still_array,\r\n    }\r\n    this.exportToJson(dict, \"state\");\r\n  }\r\n\r\n  render(){\r\n    const videoConstraints = {\r\n      facingMode: this.state.facingMode\r\n    };\r\n    return (\r\n      <div className=\"App\">\r\n        <header className=\"App-header\">\r\n        <Webcam\r\n          ref={this.webcamRef}\r\n          videoConstraints={videoConstraints}\r\n          style={{\r\n            position: \"absolute\",\r\n            marginLeft: \"auto\",\r\n            marginRight: \"auto\",\r\n            left: 0,\r\n            right: 0,\r\n            textAlign: \"center\",\r\n            zindex: 9,\r\n            width: \"auto\",\r\n            height: \"auto\",\r\n          }}\r\n        />\r\n        <canvas\r\n          ref={this.canvasRef}\r\n          style={{\r\n            position: \"absolute\",\r\n            marginLeft: \"auto\",\r\n            marginRight: \"auto\",\r\n            left: 0,\r\n            right: 0,\r\n            textAlign: \"center\",\r\n            zindex: 9,\r\n            width: \"auto\",\r\n            height: \"auto\",\r\n          }}\r\n        />\r\n        </header>\r\n          {this.state.button_mode ? (\r\n            <div>\r\n              <button onClick={this.increment_tap1} id=\"button1\">Index Finger</button>\r\n              <button onClick={this.increment_tap2} id=\"button2\">Middle Finger</button>\r\n            </div>\r\n          ) : (\r\n            <div></div>\r\n          )}\r\n\r\n          <div>\r\n            {this.state.real_time_inferencing ? (\r\n              this.state.finger_done ? (\r\n                this.state.rotate_done ? (\r\n                  this.state.fist_done ? (\r\n                    <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_real_time_inference}>Calculate Result</Button>\r\n                  ):(\r\n                    <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_gripping}>Finish Gripping</Button>\r\n                  )                  \r\n                ):(\r\n                  <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_rotating}>Finish Rotating</Button>\r\n                )\r\n              ):(\r\n                <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_tapping}>Finish Tapping</Button>\r\n              )            \r\n            ) : (\r\n            <Button disabled={this.state.recording} variant=\"contained\" color=\"primary\"  onClick={this.runHandpose}>Starting Real Time Inference</Button>\r\n            )}\r\n\r\n            {this.state.recording ? (\r\n              this.state.finger_done ? (\r\n                this.state.rotate_done ? (\r\n                  this.state.fist_done ? (\r\n                    <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_record}>Calculate Result</Button>\r\n                  ) : (\r\n                    <Button variant=\"contained\" color=\"secondary\"  onClick={this.stop_gripping}>Finish Gripping</Button>\r\n                  )                  \r\n                ):(\r\n                  <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_rotating}>Finish Rotating</Button>\r\n                )\r\n              ):(\r\n                <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_tapping}>Finish Tapping</Button>\r\n              )            \r\n            ) : (\r\n            <Button disabled={this.state.real_time_inferencing} variant=\"contained\" color=\"secondary\" onClick={this.record_video}>Starting Recording</Button>\r\n            )}\r\n\r\n            <Button disabled={this.state.recording||this.state.real_time_inferencing} variant=\"outlined\" color=\"secondary\" onClick={this.reset_counter}>\r\n              Reset All\r\n            </Button>\r\n          </div>\r\n          <div>\r\n            <h5>\r\n              Finger Tapping Count:{this.state.tap_count.length}&nbsp;&nbsp;&nbsp;&nbsp;\r\n              Rotate Count:{this.state.rotate_count.length}&nbsp;&nbsp;&nbsp;&nbsp;\r\n              Gripping Count: {this.state.fist_count.length}&nbsp;&nbsp;&nbsp;&nbsp;\r\n              FPS: {this.state.avg_fps}\r\n            </h5>\r\n          </div>\r\n          <div>\r\n            <small>Enter Real Measurement (cm)</small>\r\n            <input type=\"number\" id=\"real_measurement\" onChange={this.compose_chart} step=\"0.001\" min='0' max='20'></input>\r\n            <button disabled={!this.state.chart_ready} onClick={this.switch_style}>Switch Chart Style</button>\r\n            <button onClick={this.switch_cam}>Switch Camera</button>\r\n          </div>\r\n          <div>\r\n            <small>Experimental Features</small>\r\n            <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.runPosenet}>PoseNet</button>\r\n            <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.runFacemesh}>Facemesh</button>\r\n            <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.switch_button}>Switch On/Off Button</button>\r\n          </div>\r\n          <div>\r\n            {this.state.chart_ready ? (\r\n              <div>\r\n                <Line data={this.state.chart_data1} />\r\n                <Line data={this.state.chart_data2} />\r\n                <Line data={this.state.chart_data3} />\r\n                <Line data={this.state.chart_data4} />\r\n              </div>\r\n            ) : (\r\n              <div/>\r\n            )}\r\n            <div>\r\n              <input type=\"file\" id=\"upload-json\"></input>\r\n            </div>\r\n            <div>\r\n              <input type=\"file\" id=\"upload-weights\"></input>\r\n            </div>\r\n            <button onClick={this.getArray}>Get Array</button>\r\n          </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;"]},"metadata":{},"sourceType":"module"}