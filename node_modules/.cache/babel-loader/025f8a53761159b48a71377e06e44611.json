{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\wongh\\\\finger\\\\src\\\\App.js\";\nimport React from \"react\";\nimport Button from '@material-ui/core/Button';\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport * as posenet from \"@tensorflow-models/posenet\";\nimport * as facemesh from \"@tensorflow-models/facemesh\"; //import * as tf from '@tensorflow/tfjs-core';\n\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand, writeText, drawKeypoints, drawSkeleton, drawMesh } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\";\nimport { Line } from 'react-chartjs-2';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.sleep = milliseconds => {\n      return new Promise(resolve => setTimeout(resolve, milliseconds));\n    };\n\n    this.record_estimateHands = async (img, net, ctx) => {\n      const hand = await net.estimateHands(img);\n      console.log(hand);\n\n      if (hand.length > 0) {\n        //drawHand(hand, ctx);   \n        this.setState({\n          dead_frame: 0\n        });\n      } else {\n        if (this.state.dead_frame === 1) writeText(ctx, {\n          text: 'Hand Off Screen',\n          x: 180,\n          y: 70\n        });\n        this.setState({\n          dead_frame: 1\n        });\n      }\n    };\n\n    this.state = {\n      ID: 0,\n      tap_count: [],\n      rotate_count: [],\n      fist_count: [],\n      index_passed: 0,\n      rotate_passed: 0,\n      last_pressed: 0,\n      real_time_inferencing: false,\n      recording: false,\n      button_mode: false,\n      chart_ready: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false,\n      pawn_dist_array: [],\n      pawn_rotate_array: [],\n      pawn_fist_array: [],\n      dist_array: [],\n      dist_time_array: [],\n      dist_record: [],\n      dist_time_record: [],\n      rotate_array: [],\n      rotate_time_array: [],\n      rotate_record: [],\n      rotate_time_record: [],\n      fist_array: [],\n      fist_time_array: [],\n      fist_record: [],\n      fist_time_record: [],\n      gait_record: [],\n      gait_time_record: [],\n      chart_data1: null,\n      chart_data2: null,\n      chart_data3: null,\n      wait: false,\n      wait_till: 0,\n      startAt: Date.now(),\n      dead_frame: 0,\n      ctx: null,\n      raw: false,\n      facingMode: \"user\"\n    };\n    this.webcamRef = /*#__PURE__*/React.createRef(null);\n    this.canvasRef = /*#__PURE__*/React.createRef(null);\n    this.videoConstraints = {\n      facingMode: \"user\"\n    };\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_tapping = this.stop_tapping.bind(this);\n    this.stop_rotating = this.stop_rotating.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n    this.increment_tap1 = this.increment_tap1.bind(this);\n    this.increment_tap2 = this.increment_tap2.bind(this);\n    this.switch_button = this.switch_button.bind(this);\n    this.compose_chart = this.compose_chart.bind(this);\n    this.runPosenet = this.runPosenet.bind(this);\n    this.read_time_posenet = this.read_time_posenet.bind(this);\n    this.runFacemesh = this.runFacemesh.bind(this);\n    this.read_time_facemesh = this.read_time_facemesh.bind(this);\n    this.switch_style = this.switch_style.bind(this);\n    this.switch_cam = this.switch_cam.bind(this);\n  }\n\n  switch_cam() {\n    if (this.state.facingMode === \"user\") this.setState({\n      facingMode: \"environment\"\n    });else if (this.state.facingMode === \"environment\") this.setState({\n      facingMode: \"user\"\n    });\n  }\n\n  async runFacemesh() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await facemesh.load();\n    console.log(\"Facemesh model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.read_time_facemesh(net);\n    }, 50);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      real_time_inferencing: true\n    });\n  }\n\n  async read_time_facemesh(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      }); //await this.sleep(3000);\n\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const face = await net.estimateFaces(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawMesh(face, ctx);\n    }\n  }\n\n  async runPosenet() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await posenet.load();\n    console.log(\"PoseNet model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.read_time_posenet(net);\n    }, 50);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      real_time_inferencing: true\n    });\n  }\n\n  async read_time_posenet(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      }); //await this.sleep(3000);\n\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const pose = await net.estimateSinglePose(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawKeypoints(pose[\"keypoints\"], 0.6, ctx);\n      drawSkeleton(pose[\"keypoints\"], 0.7, ctx);\n    }\n  }\n\n  async switch_style() {\n    await this.setState({\n      raw: !this.state.raw\n    });\n    this.compose_chart();\n  }\n\n  compose_chart() {\n    let time_array_1 = [];\n    let count_array_1 = [];\n    let time_array_2 = [];\n    let count_array_2 = [];\n    let time_array_3 = [];\n    let count_array_3 = [];\n    let real_dist = document.getElementById(\"real_measurement\").value; // change to real life measurement\n\n    if (this.state.raw) {\n      time_array_1 = [...this.state.dist_time_array];\n      count_array_1 = [...this.state.dist_array];\n      time_array_2 = [...this.state.rotate_time_array];\n      count_array_2 = [...this.state.rotate_array];\n      time_array_3 = [...this.state.fist_time_array];\n      count_array_3 = [...this.state.fist_array];\n\n      if (real_dist > 0.0001) {\n        let i = 0;\n        let tmp = 0;\n\n        for (i = 0; i < count_array_1.length; i++) {\n          tmp = count_array_1[i];\n          count_array_1[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_2.length; i++) {\n          tmp = count_array_2[i];\n          count_array_2[i] = tmp * real_dist;\n        }\n\n        for (i = 0; i < count_array_3.length; i++) {\n          tmp = count_array_3[i];\n          count_array_3[i] = tmp * real_dist;\n        }\n      }\n    } else {\n      // Recalculate Tapping Data\n      let start = this.state.dist_time_array[0];\n      let end = this.state.dist_time_array[this.state.dist_time_array.length - 1];\n\n      while (start + 1.0 < end) {\n        time_array_1 = [...time_array_1, start];\n        let count = 0,\n            temp_max = 0;\n\n        for (let i = 0; i < this.state.dist_array.length; i++) {\n          if (this.state.dist_time_array[i] >= start && this.state.dist_time_array[i] < start + 1.0) {\n            if (temp_max < this.state.dist_array[i]) temp_max = this.state.dist_array[i];\n\n            if (this.state.tap_count.includes(this.state.dist_time_array[i])) {\n              count += temp_max;\n              temp_max = 0;\n            }\n          }\n        }\n\n        count_array_1 = [...count_array_1, count];\n        start += 0.1;\n      } // Recalculate Rotate Data\n\n\n      start = this.state.rotate_time_array[0];\n      end = this.state.rotate_time_array[this.state.rotate_time_array.length - 1];\n\n      while (start + 5.0 < end) {\n        time_array_2 = [...time_array_2, start + 2.5];\n        let count = 0.0;\n        let time_value = 0;\n\n        for (let tc in this.state.rotate_count) {\n          time_value = this.state.rotate_count[tc];\n\n          if (time_value >= start && time_value < start + 5.0) {\n            count += 1.0;\n          }\n        }\n\n        count_array_2 = [...count_array_2, count];\n        start += 0.1;\n      } // Recalculate Gripping Data\n\n\n      start = this.state.fist_time_array[0];\n      end = this.state.fist_time_array[this.state.fist_time_array.length - 1];\n\n      while (start + 5.0 < end) {\n        time_array_3 = [...time_array_3, start + 2.5];\n        let count = 0.0;\n        let time_value = 0;\n\n        for (let tc in this.state.fist_count) {\n          time_value = this.state.fist_count[tc];\n\n          if (time_value >= start && time_value < start + 5.0) {\n            count += 1.0;\n          }\n        }\n\n        count_array_3 = [...count_array_3, count];\n        start += 0.1;\n      }\n    }\n\n    const data1 = {\n      labels: time_array_1,\n      datasets: [{\n        label: 'Tapping',\n        fill: false,\n        lineTension: 0.3,\n        backgroundColor: 'rgba(75,192,192,0.4)',\n        borderColor: 'rgba(75,192,192,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(75,192,192,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(75,192,192,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_1\n      }]\n    };\n    const data2 = {\n      labels: time_array_2,\n      datasets: [{\n        label: 'Rotation',\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: 'rgba(192,75,192,0.4)',\n        borderColor: 'rgba(192,75,192,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(192,75,192,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(192,75,192,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_2\n      }]\n    };\n    const data3 = {\n      labels: time_array_3,\n      datasets: [{\n        label: 'Fist',\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: 'rgba(192,192,75,0.4)',\n        borderColor: 'rgba(192,192,75,1)',\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: 'miter',\n        pointBorderColor: 'rgba(192,192,75,1)',\n        pointBackgroundColor: '#fff',\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: 'rgba(192,192,75,1)',\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n        data: count_array_3\n      }]\n    };\n    this.setState({\n      chart_data1: data1\n    });\n    this.setState({\n      chart_data2: data2\n    });\n    this.setState({\n      chart_data3: data3\n    });\n    this.setState({\n      chart_ready: true\n    });\n  }\n\n  switch_button() {\n    if (this.state.button_mode === true) {\n      this.setState({\n        button_mode: false\n      });\n      this.compose_chart();\n    } else {\n      this.setState({\n        button_mode: true\n      });\n    }\n  }\n\n  increment_tap1() {\n    if (this.state.last_pressed !== 1) {\n      let current_moment = (Date.now() - this.state.startAt) / 1000;\n      this.setState({\n        last_pressed: 1\n      });\n      this.setState({\n        dist_array: [...this.state.dist_array, 1.0]\n      });\n      this.setState({\n        dist_time_array: [...this.state.dist_time_array, current_moment]\n      });\n      this.setState({\n        tap_count: [...this.state.tap_count, current_moment]\n      });\n    }\n  }\n\n  increment_tap2() {\n    if (this.state.last_pressed !== 2) {\n      let current_moment = (Date.now() - this.state.startAt) / 1000;\n      this.setState({\n        last_pressed: 2\n      });\n      this.setState({\n        dist_array: [...this.state.dist_array, 1.0]\n      });\n      this.setState({\n        dist_time_array: [...this.state.dist_time_array, current_moment]\n      });\n      this.setState({\n        tap_count: [...this.state.tap_count, current_moment]\n      });\n    }\n  }\n\n  norm(lm1, lm2) {\n    return sqrt(pow(lm1[0] - lm2[0], 2) + pow(lm1[1] - lm2[1], 2));\n  }\n\n  reset_counter() {\n    clearInterval(this.state.ID);\n    if (this.state.ctx != null) this.state.ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState({\n      ID: 0,\n      tap_count: [],\n      rotate_count: [],\n      fist_count: [],\n      index_passed: 0,\n      rotate_passed: 0,\n      last_pressed: 0,\n      real_time_inferencing: false,\n      recording: false,\n      button_mode: false,\n      chart_ready: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false,\n      dist_array: [],\n      dist_time_array: [],\n      dist_record: [],\n      dist_time_record: [],\n      rotate_array: [],\n      rotate_time_array: [],\n      rotate_record: [],\n      rotate_time_record: [],\n      fist_array: [],\n      fist_time_array: [],\n      fist_record: [],\n      fist_time_record: [],\n      gait_record: [],\n      gait_time_record: [],\n      chart_data1: null,\n      chart_data2: null,\n      chart_data3: null,\n      wait: false,\n      wait_till: 0,\n      startAt: Date.now(),\n      dead_frame: 0\n    });\n  }\n\n  async runHandpose() {\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    writeText(ctx, {\n      text: 'Loading',\n      x: 180,\n      y: 70\n    });\n\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height); //const uploadJSONInput = document.getElementById('upload-json');\n    //const uploadWeightsInput = document.getElementById('upload-weights');\n    //const model = await tf.loadLayersModel(tf.io.browserFiles([uploadJSONInput.files[0], uploadWeightsInput.files[0]]));\n\n    console.log(\"Handpose model loaded.\");\n    this.setState({\n      startAt: Date.now()\n    });\n    const Interval_ID = setInterval(() => {\n      this.read_time_inference(net);\n    }, 40);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      real_time_inferencing: true\n    });\n  }\n\n  async read_time_inference(net) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      }); //await this.sleep(3000);\n\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      this.setState({\n        ctx: ctx\n      }); //check if hand exist, if yes, drawhand\n\n      if (hand.length > 0) drawHand(hand, ctx); //check if waiting\n\n      if (Date.now() < this.state.wait_till) {\n        console.log(\"Waiting till \", this.state.wait_till); //count down 3, 2, 1\n\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, {\n          text: '1',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, {\n          text: '2',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, {\n          text: '3',\n          x: 180,\n          y: 70\n        });\n      } else {\n        if (hand.length > 0) {\n          hand.forEach(prediction => {\n            this.setState({\n              dead_frame: 0\n            });\n            const landmarks = prediction.landmarks;\n            let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n            let current_moment = (Date.now() - this.state.startAt) / 1000;\n\n            if (this.state.finger_done === false) {\n              let index_dist = this.norm(landmarks[4], landmarks[8]);\n              index_dist = index_dist / pawn_dist;\n              this.setState({\n                pawn_dist_array: [...this.state.pawn_dist_array, pawn_dist]\n              });\n              this.setState({\n                dist_array: [...this.state.dist_array, index_dist]\n              });\n              this.setState({\n                dist_time_array: [...this.state.dist_time_array, current_moment]\n              });\n              let threshold = 0.5;\n\n              if (this.state.dist_array.length > 20) {\n                let j = 1;\n                let avg = 0.0;\n\n                for (j = 1; j <= 20; j++) avg += this.state.dist_array[this.state.dist_array.length - j];\n\n                threshold = avg / 40.0 + threshold / 2.0;\n                console.log(threshold);\n              }\n\n              if (index_dist >= threshold + 0.01) {\n                this.setState({\n                  index_passed: 1\n                });\n              }\n\n              if (index_dist < threshold - 0.01 && this.state.index_passed === 1) {\n                this.setState({\n                  index_passed: 0\n                });\n                this.setState({\n                  tap_count: [...this.state.tap_count, current_moment]\n                });\n              }\n            }\n\n            if (this.state.finger_done === true && this.state.rotate_done === false) {\n              let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n              this.setState({\n                pawn_rotate_array: [...this.state.pawn_rotate_array, pawn_dist]\n              });\n              this.setState({\n                rotate_array: [...this.state.rotate_array, rotate_dist]\n              });\n              this.setState({\n                rotate_time_array: [...this.state.rotate_time_array, current_moment]\n              });\n\n              if (this.state.rotate_passed === 0) {\n                if (rotate_dist >= 0.25) this.setState({\n                  rotate_passed: 1\n                });\n                if (rotate_dist <= -0.25) this.setState({\n                  rotate_passed: -1\n                });\n              }\n\n              if (this.state.rotate_passed === 1 && rotate_dist <= -0.5) {\n                this.setState({\n                  rotate_passed: -1\n                });\n              }\n\n              if (this.state.rotate_passed === -1 && rotate_dist >= 0.5) {\n                this.setState({\n                  rotate_passed: 1\n                });\n                this.setState({\n                  rotate_count: [...this.state.rotate_count, current_moment]\n                });\n              }\n            }\n\n            if (this.state.rotate_done === true && this.state.fist_done === false) {\n              let fist_dist = (landmarks[8][1] - landmarks[5][1] + (landmarks[12][1] - landmarks[9][1]) + (landmarks[16][1] - landmarks[13][1]) + (landmarks[20][1] - landmarks[17][1])) / (4 * pawn_dist);\n              this.setState({\n                pawn_fist_array: [...this.state.pawn_fist_array, pawn_dist]\n              });\n              this.setState({\n                fist_array: [...this.state.fist_array, fist_dist]\n              });\n              this.setState({\n                fist_time_array: [...this.state.fist_time_array, current_moment]\n              });\n\n              if (fist_dist >= 0.0) {\n                this.setState({\n                  fist_passed: 1\n                });\n              }\n\n              if (fist_dist < -0.4 && this.state.fist_passed === 1) {\n                this.setState({\n                  fist_passed: 0\n                });\n                this.setState({\n                  fist_count: [...this.state.fist_count, current_moment]\n                });\n              }\n            }\n          });\n        } else {\n          if (this.state.dead_frame > 9) writeText(ctx, {\n            text: 'Hand Off Screen',\n            x: 180,\n            y: 70\n          });\n          this.setState({\n            dead_frame: this.state.dead_frame + 1\n          });\n        }\n      }\n    }\n  }\n\n  async stop_tapping() {\n    this.setState({\n      finger_done: true\n    });\n    this.setState({\n      wait: true\n    });\n  }\n\n  async stop_rotating() {\n    this.setState({\n      rotate_done: true\n    });\n    this.setState({\n      wait: true\n    });\n  }\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({\n      real_time_inferencing: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false\n    });\n    this.compose_chart();\n  }\n\n  async record_video() {\n    this.setState({\n      startAt: Date.now()\n    });\n    let count = 0;\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    writeText(ctx, {\n      text: 'Loading',\n      x: 180,\n      y: 70\n    });\n\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState({\n      ctx: ctx\n    });\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.concat_frame(count, net, ctx);\n      count = (count + 1) % 20;\n    }, 40);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      recording: true\n    });\n  }\n\n  async concat_frame(count, net, ctx) {\n    if (this.state.wait) {\n      this.setState({\n        wait_till: Date.now() + 3000\n      }); //await this.sleep(3000);\n\n      this.setState({\n        wait: false\n      });\n    }\n\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      if (Date.now() < this.state.wait_till) {\n        console.log(\"Waiting till \", this.state.wait_till); //count down 3, 2, 1\n\n        ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, {\n          text: '1',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, {\n          text: '2',\n          x: 180,\n          y: 70\n        });else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, {\n          text: '3',\n          x: 180,\n          y: 70\n        });\n      } else {\n        ctx.clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n        let current_moment = (Date.now() - this.state.startAt) / 1000;\n        const image = this.webcamRef.current.getScreenshot();\n        var img = document.createElement(\"img\");\n\n        img.onload = function () {\n          if (this.state.finger_done === false) {\n            this.setState({\n              dist_record: [...this.state.dist_record, img]\n            });\n            this.setState({\n              dist_time_record: [...this.state.dist_time_record, current_moment]\n            });\n          } else if (this.state.finger_done === true && this.state.rotate_done === false) {\n            this.setState({\n              rotate_record: [...this.state.rotate_record, img]\n            });\n            this.setState({\n              rotate_time_record: [...this.state.rotate_time_record, current_moment]\n            });\n          } else if (this.state.rotate_done === true && this.state.fist_done === false) {\n            this.setState({\n              fist_record: [...this.state.fist_record, img]\n            });\n            this.setState({\n              fist_time_record: [...this.state.fist_time_record, current_moment]\n            });\n          }\n\n          if (count === 0) this.record_estimateHands(img, net, ctx);\n        }.bind(this);\n\n        img.src = image;\n      }\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\"); // Run prediction on recorded tapping data\n\n    for (let i = 0; i < this.state.dist_record.length; i++) {\n      const hand = await net.estimateHands(this.state.dist_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let index_dist = this.norm(landmarks[4], landmarks[8]);\n          index_dist = index_dist / pawn_dist;\n          let threshold = 0.5;\n\n          if (i > 20) {\n            let j = 1;\n            let avg = 0.0;\n\n            for (j = 1; j <= 20; j++) avg += this.state.dist_array[i - j];\n\n            threshold = avg / 40.0 + threshold / 2.0;\n            console.log(threshold);\n          }\n\n          this.setState({\n            pawn_dist_array: [...this.state.pawn_dist_array, pawn_dist]\n          });\n          this.setState({\n            dist_array: [...this.state.dist_array, index_dist]\n          });\n          this.setState({\n            dist_time_array: [...this.state.dist_time_array, this.state.dist_time_record[i]]\n          });\n\n          if (index_dist >= threshold + 0.125) {\n            this.setState({\n              index_passed: 1\n            });\n          }\n\n          if (index_dist < threshold - 0.125 && this.state.index_passed === 1) {\n            this.setState({\n              index_passed: 0\n            });\n            this.setState({\n              tap_count: [...this.state.tap_count, this.state.dist_time_record[i]]\n            });\n          }\n\n          console.log(\"INDEX COUNT:\", this.state.tap_count);\n        });\n      }\n    } // Run prediction on recorded rotation data\n\n\n    for (let i = 0; i < this.state.rotate_record.length; i++) {\n      const hand = await net.estimateHands(this.state.rotate_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n          this.setState({\n            pawn_rotate_array: [...this.state.pawn_rotate_array, pawn_dist]\n          });\n          this.setState({\n            rotate_array: [...this.state.rotate_array, rotate_dist]\n          });\n          this.setState({\n            rotate_time_array: [...this.state.rotate_time_array, this.state.rotate_time_record[i]]\n          });\n\n          if (this.state.rotate_passed === 0) {\n            if (rotate_dist >= 0.5) this.setState({\n              rotate_passed: 1\n            });\n            if (rotate_dist <= -0.5) this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5) {\n            this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5) {\n            this.setState({\n              rotate_passed: 1\n            });\n            this.setState({\n              rotate_count: [...this.state.rotate_count, this.state.rotate_time_record[i]]\n            });\n          }\n\n          console.log(\"ROTATE COUNT:\", this.state.rotate_count);\n        });\n      }\n    } // Run prediction on recorded gripping data\n\n\n    for (let i = 0; i < this.state.fist_record.length; i++) {\n      const hand = await net.estimateHands(this.state.fist_record[i]);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let fist_dist = (landmarks[8][1] - landmarks[5][1] + (landmarks[12][1] - landmarks[9][1]) + (landmarks[16][1] - landmarks[13][1]) + (landmarks[20][1] - landmarks[17][1])) / (4 * pawn_dist);\n          this.setState({\n            pawn_fist_array: [...this.state.pawn_fist_array, pawn_dist]\n          });\n          this.setState({\n            fist_array: [...this.state.fist_array, fist_dist]\n          });\n          this.setState({\n            fist_time_array: [...this.state.fist_time_array, this.state.fist_time_record[i]]\n          });\n\n          if (fist_dist >= 0.0) {\n            this.setState({\n              fist_passed: 1\n            });\n          }\n\n          if (fist_dist < -0.4 && this.state.fist_passed === 1) {\n            this.setState({\n              fist_passed: 0\n            });\n            this.setState({\n              fist_count: [...this.state.fist_count, this.state.fist_time_record[i]]\n            });\n          }\n\n          console.log(\"FIST COUNT:\", this.state.fist_count);\n        });\n      }\n    }\n\n    this.setState({\n      record: []\n    });\n  }\n\n  async stop_record() {\n    clearInterval(this.state.ID);\n    await this.inference();\n    this.setState({\n      recording: false,\n      finger_done: false,\n      rotate_done: false,\n      fist_done: false\n    });\n    this.compose_chart();\n  }\n\n  render() {\n    const videoConstraints = {\n      facingMode: this.state.facingMode\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"App-header\",\n        children: [/*#__PURE__*/_jsxDEV(Webcam, {\n          ref: this.webcamRef,\n          videoConstraints: videoConstraints,\n          style: {\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 751,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: this.canvasRef,\n          style: {\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 766,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 750,\n        columnNumber: 9\n      }, this), this.state.button_mode ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.increment_tap1,\n          id: \"button1\",\n          children: \"Index Finger\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 783,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.increment_tap2,\n          id: \"button2\",\n          children: \"Middle Finger\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 782,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 787,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [this.state.real_time_inferencing ? this.state.finger_done ? this.state.rotate_done ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_real_time_inference,\n          children: \"Calculate Result\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 794,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_rotating,\n          children: \"Finish Rotating\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 796,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.stop_tapping,\n          children: \"Finish Tapping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 799,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.recording,\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: this.runHandpose,\n          children: \"Starting Real Time Inference\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 802,\n          columnNumber: 13\n        }, this), this.state.recording ? this.state.finger_done ? this.state.rotate_done ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_record,\n          children: \"Calculate Result\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 808,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_rotating,\n          children: \"Finish Rotating\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 810,\n          columnNumber: 19\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.stop_tapping,\n          children: \"Finish Tapping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 813,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.real_time_inferencing,\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: this.record_video,\n          children: \"Starting Recording\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          disabled: this.state.recording || this.state.real_time_inferencing,\n          variant: \"outlined\",\n          color: \"secondary\",\n          onClick: this.reset_counter,\n          children: \"Reset All\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 819,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 790,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        id: \"real_measurement\",\n        onChange: this.compose_chart,\n        step: \"0.001\",\n        min: \"0\",\n        max: \"20\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 824,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: !this.state.chart_ready,\n        onClick: this.switch_style,\n        children: \"Switch Chart Style\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 825,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: this.switch_cam,\n        children: \"Switch Camera\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 826,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: this.state.recording || this.state.real_time_inferencing,\n        onClick: this.runPosenet,\n        children: \"PoseNet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 827,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: this.state.recording || this.state.real_time_inferencing,\n        onClick: this.runFacemesh,\n        children: \"Facemesh\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 828,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: this.state.recording || this.state.real_time_inferencing,\n        onClick: this.switch_button,\n        children: \"Switch On/Off Button\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 829,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        children: [\"Finger Tapping Count:\", this.state.tap_count.length, \"\\xA0\\xA0\\xA0\\xA0 Rotate Count:\", this.state.rotate_count.length, \"\\xA0\\xA0\\xA0\\xA0 Gripping Count: \", this.state.fist_count.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 830,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [this.state.chart_ready ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 838,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data2\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 839,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Line, {\n            data: this.state.chart_data3\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 840,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 843,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"upload-json\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 846,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 845,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"upload-weights\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 849,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 848,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 835,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 749,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/wongh/finger/src/App.js"],"names":["React","Button","handpose","posenet","facemesh","Webcam","drawHand","writeText","drawKeypoints","drawSkeleton","drawMesh","sqrt","pow","Line","App","Component","constructor","props","sleep","milliseconds","Promise","resolve","setTimeout","record_estimateHands","img","net","ctx","hand","estimateHands","console","log","length","setState","dead_frame","state","text","x","y","ID","tap_count","rotate_count","fist_count","index_passed","rotate_passed","last_pressed","real_time_inferencing","recording","button_mode","chart_ready","finger_done","rotate_done","fist_done","pawn_dist_array","pawn_rotate_array","pawn_fist_array","dist_array","dist_time_array","dist_record","dist_time_record","rotate_array","rotate_time_array","rotate_record","rotate_time_record","fist_array","fist_time_array","fist_record","fist_time_record","gait_record","gait_time_record","chart_data1","chart_data2","chart_data3","wait","wait_till","startAt","Date","now","raw","facingMode","webcamRef","createRef","canvasRef","videoConstraints","runHandpose","bind","stop_real_time_inference","stop_tapping","stop_rotating","stop_record","record_video","concat_frame","inference","reset_counter","increment_tap1","increment_tap2","switch_button","compose_chart","runPosenet","read_time_posenet","runFacemesh","read_time_facemesh","switch_style","switch_cam","require","load","Interval_ID","setInterval","current","video","readyState","videoWidth","videoHeight","width","height","face","estimateFaces","getContext","pose","estimateSinglePose","time_array_1","count_array_1","time_array_2","count_array_2","time_array_3","count_array_3","real_dist","document","getElementById","value","i","tmp","start","end","count","temp_max","includes","time_value","tc","data1","labels","datasets","label","fill","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","data","data2","data3","current_moment","norm","lm1","lm2","clearInterval","clearRect","read_time_inference","forEach","prediction","landmarks","pawn_dist","index_dist","threshold","j","avg","rotate_dist","fist_dist","fist_passed","image","getScreenshot","createElement","onload","src","record","render","position","marginLeft","marginRight","left","right","textAlign","zindex"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Button from '@material-ui/core/Button';\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport * as posenet from \"@tensorflow-models/posenet\";\nimport * as facemesh from \"@tensorflow-models/facemesh\";\n//import * as tf from '@tensorflow/tfjs-core';\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand, writeText, drawKeypoints, drawSkeleton, drawMesh } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\"\nimport {Line} from 'react-chartjs-2';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ID : 0,\n      tap_count : [],\n      rotate_count : [],\n      fist_count : [],\n      index_passed : 0,\n      rotate_passed : 0,\n      last_pressed:0,\n      real_time_inferencing:false,\n      recording:false,\n      button_mode:false,\n      chart_ready:false,\n      finger_done : false,\n      rotate_done : false,\n      fist_done : false,\n      pawn_dist_array : [],\n      pawn_rotate_array : [],\n      pawn_fist_array : [],\n      dist_array : [],\n      dist_time_array : [],\n      dist_record : [],\n      dist_time_record : [],\n      rotate_array : [],\n      rotate_time_array : [],\n      rotate_record : [],\n      rotate_time_record : [],\n      fist_array : [],\n      fist_time_array : [],\n      fist_record : [],\n      fist_time_record : [],\n      gait_record : [],\n      gait_time_record : [],\n      chart_data1 : null,\n      chart_data2 : null,\n      chart_data3 : null,\n      wait : false,\n      wait_till : 0,\n      startAt: Date.now(),\n      dead_frame: 0,\n      ctx: null,\n      raw: false,\n      facingMode: \"user\",\n    };\n    this.webcamRef = React.createRef(null);\n    this.canvasRef = React.createRef(null);\n    this.videoConstraints = {facingMode: \"user\"};\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_tapping = this.stop_tapping.bind(this);\n    this.stop_rotating = this.stop_rotating.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n    this.increment_tap1 = this.increment_tap1.bind(this);\n    this.increment_tap2 = this.increment_tap2.bind(this);\n    this.switch_button = this.switch_button.bind(this);\n    this.compose_chart = this.compose_chart.bind(this);\n    this.runPosenet = this.runPosenet.bind(this);\n    this.read_time_posenet = this.read_time_posenet.bind(this);\n    this.runFacemesh = this.runFacemesh.bind(this);\n    this.read_time_facemesh = this.read_time_facemesh.bind(this);\n    this.switch_style = this.switch_style.bind(this);\n    this.switch_cam = this.switch_cam.bind(this);\n  }\n\n  switch_cam(){\n    if (this.state.facingMode === \"user\") this.setState({facingMode: \"environment\"});\n    else if (this.state.facingMode === \"environment\") this.setState({facingMode: \"user\"});\n  }\n\n  async runFacemesh(){\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await facemesh.load();\n    console.log(\"Facemesh model loaded.\");\n    this.setState({startAt:Date.now()});\n    const Interval_ID = setInterval(() => {\n      this.read_time_facemesh(net);\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({real_time_inferencing:true});\n  }\n\n  async read_time_facemesh(net) {\n    if (this.state.wait){\n      this.setState({wait_till:Date.now()+3000});\n      //await this.sleep(3000);\n      this.setState({wait:false});\n    }\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const face = await net.estimateFaces(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawMesh(face, ctx);\n    }\n  }\n\n  async runPosenet(){\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await posenet.load();\n    console.log(\"PoseNet model loaded.\");\n    this.setState({startAt:Date.now()});\n    const Interval_ID = setInterval(() => {\n      this.read_time_posenet(net);\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({real_time_inferencing:true});\n  }\n\n  async read_time_posenet(net) {\n    if (this.state.wait){\n      this.setState({wait_till:Date.now()+3000});\n      //await this.sleep(3000);\n      this.setState({wait:false});\n    }\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const pose = await net.estimateSinglePose(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      drawKeypoints(pose[\"keypoints\"], 0.6, ctx);\n      drawSkeleton(pose[\"keypoints\"], 0.7, ctx);\n    }\n  }\n\n  async switch_style(){\n    await this.setState({raw: !this.state.raw});\n    this.compose_chart();\n  }\n\n  compose_chart(){\n    let time_array_1 = [];\n    let count_array_1 = [];\n    let time_array_2 = [];\n    let count_array_2 = [];\n    let time_array_3 = [];\n    let count_array_3 = [];\n\n    let real_dist = document.getElementById(\"real_measurement\").value;\n    // change to real life measurement\n\n    if (this.state.raw){\n      time_array_1 = [...this.state.dist_time_array];\n      count_array_1 = [...this.state.dist_array];\n      time_array_2 = [...this.state.rotate_time_array];\n      count_array_2 = [...this.state.rotate_array];\n      time_array_3 = [...this.state.fist_time_array];\n      count_array_3 = [...this.state.fist_array];\n      if (real_dist > 0.0001){\n        let i = 0;\n        let tmp = 0;\n        for (i = 0; i < count_array_1.length; i++){\n          tmp = count_array_1[i];\n          count_array_1[i] = tmp*real_dist;\n        }\n        for (i = 0; i < count_array_2.length; i++){\n          tmp = count_array_2[i];\n          count_array_2[i] = tmp*real_dist;\n        }\n        for (i = 0; i < count_array_3.length; i++){\n          tmp = count_array_3[i];\n          count_array_3[i] = tmp*real_dist;\n        }\n      }\n    }\n    else{\n      // Recalculate Tapping Data\n      let start = this.state.dist_time_array[0];\n      let end = this.state.dist_time_array[this.state.dist_time_array.length - 1];\n      while (start + 1.0 < end){\n        time_array_1 = [...time_array_1, start];\n        let count = 0, temp_max = 0;\n        for (let i = 0; i < this.state.dist_array.length; i++){        \n          if (this.state.dist_time_array[i] >= start && this.state.dist_time_array[i] < (start + 1.0)){\n            if (temp_max < this.state.dist_array[i]) temp_max = this.state.dist_array[i];\n            if (this.state.tap_count.includes(this.state.dist_time_array[i])){\n              count += temp_max;\n              temp_max = 0;\n            }\n          }\n        }\n        count_array_1 = [...count_array_1, count];\n        start += 0.1;\n      }\n\n      // Recalculate Rotate Data\n      start = this.state.rotate_time_array[0];\n      end = this.state.rotate_time_array[this.state.rotate_time_array.length - 1];\n      while (start + 5.0 < end){\n        time_array_2 = [...time_array_2, start + 2.5];\n        let count = 0.0;\n        let time_value = 0;\n        for (let tc in this.state.rotate_count){\n          time_value = this.state.rotate_count[tc];\n          if (time_value >= start && time_value < (start + 5.0)){\n            count += 1.0;\n          }\n        }\n        count_array_2 = [...count_array_2, count];\n        start += 0.1;\n      }\n\n      // Recalculate Gripping Data\n      start = this.state.fist_time_array[0];\n      end = this.state.fist_time_array[this.state.fist_time_array.length - 1];\n      while (start + 5.0 < end){\n        time_array_3 = [...time_array_3, start + 2.5];\n        let count = 0.0;\n        let time_value = 0;\n        for (let tc in this.state.fist_count){\n          time_value = this.state.fist_count[tc];\n          if (time_value >= start && time_value < (start + 5.0)){\n            count += 1.0;\n          }\n        }\n        count_array_3 = [...count_array_3, count];\n        start += 0.1;\n      }\n    }\n      \n    const data1 = {\n      labels: time_array_1,\n      datasets: [        \n        {\n          label: 'Tapping',\n          fill: false,\n          lineTension: 0.3,\n          backgroundColor: 'rgba(75,192,192,0.4)',\n          borderColor: 'rgba(75,192,192,1)',\n          borderCapStyle: 'butt',\n          borderDash: [],\n          borderDashOffset: 0.0,\n          borderJoinStyle: 'miter',\n          pointBorderColor: 'rgba(75,192,192,1)',\n          pointBackgroundColor: '#fff',\n          pointBorderWidth: 1,\n          pointHoverRadius: 5,\n          pointHoverBackgroundColor: 'rgba(75,192,192,1)',\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\n          pointHoverBorderWidth: 2,\n          pointRadius: 1,\n          pointHitRadius: 10,\n          data: count_array_1\n        }\n      ]\n    };\n    const data2 = {\n      labels: time_array_2,\n      datasets: [        \n        {\n          label: 'Rotation',\n          fill: false,\n          lineTension: 0.1,\n          backgroundColor: 'rgba(192,75,192,0.4)',\n          borderColor: 'rgba(192,75,192,1)',\n          borderCapStyle: 'butt',\n          borderDash: [],\n          borderDashOffset: 0.0,\n          borderJoinStyle: 'miter',\n          pointBorderColor: 'rgba(192,75,192,1)',\n          pointBackgroundColor: '#fff',\n          pointBorderWidth: 1,\n          pointHoverRadius: 5,\n          pointHoverBackgroundColor: 'rgba(192,75,192,1)',\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\n          pointHoverBorderWidth: 2,\n          pointRadius: 1,\n          pointHitRadius: 10,\n          data: count_array_2 \n        },\n      ]\n    };\n    const data3 = {\n      labels: time_array_3,\n      datasets: [        \n        {\n          label: 'Fist',\n          fill: false,\n          lineTension: 0.1,\n          backgroundColor: 'rgba(192,192,75,0.4)',\n          borderColor: 'rgba(192,192,75,1)',\n          borderCapStyle: 'butt',\n          borderDash: [],\n          borderDashOffset: 0.0,\n          borderJoinStyle: 'miter',\n          pointBorderColor: 'rgba(192,192,75,1)',\n          pointBackgroundColor: '#fff',\n          pointBorderWidth: 1,\n          pointHoverRadius: 5,\n          pointHoverBackgroundColor: 'rgba(192,192,75,1)',\n          pointHoverBorderColor: 'rgba(220,220,220,1)',\n          pointHoverBorderWidth: 2,\n          pointRadius: 1,\n          pointHitRadius: 10,\n          data: count_array_3\n        }\n      ]\n    };\n\n    this.setState({chart_data1:data1});\n    this.setState({chart_data2:data2});\n    this.setState({chart_data3:data3});\n    this.setState({chart_ready:true});\n  }\n\n  switch_button(){\n    if (this.state.button_mode === true){\n      this.setState({button_mode:false});\n      this.compose_chart();\n    }\n    else{\n      this.setState({button_mode:true})\n    }\n  }\n\n  increment_tap1(){\n    if (this.state.last_pressed !== 1){\n      let current_moment = (Date.now() - this.state.startAt)/1000\n      this.setState({last_pressed:1})\n      this.setState({dist_array:[...this.state.dist_array, 1.0]});\n      this.setState({dist_time_array:[...this.state.dist_time_array, current_moment]});\n      this.setState({tap_count:[...this.state.tap_count, current_moment]});\n    }\n  }\n\n  increment_tap2(){\n    if (this.state.last_pressed !== 2){\n      let current_moment = (Date.now() - this.state.startAt)/1000\n      this.setState({last_pressed:2})\n      this.setState({dist_array:[...this.state.dist_array, 1.0]});\n      this.setState({dist_time_array:[...this.state.dist_time_array, current_moment]});\n      this.setState({tap_count:[...this.state.tap_count, current_moment]});\n    }\n  }\n\n  norm(lm1, lm2){\n    return sqrt(pow(lm1[0]-lm2[0], 2)+pow(lm1[1]-lm2[1], 2))\n  }\n\n  reset_counter(){\n    clearInterval(this.state.ID);\n    if (this.state.ctx != null) this.state.ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState({\n      ID : 0,\n      tap_count : [],\n      rotate_count : [],\n      fist_count : [],\n      index_passed : 0,\n      rotate_passed : 0,\n      last_pressed:0,\n      real_time_inferencing:false,\n      recording:false,\n      button_mode:false,\n      chart_ready:false,\n      finger_done : false,\n      rotate_done : false,\n      fist_done : false,\n      dist_array : [],\n      dist_time_array : [],\n      dist_record : [],\n      dist_time_record : [],\n      rotate_array : [],\n      rotate_time_array : [],\n      rotate_record : [],\n      rotate_time_record : [],\n      fist_array : [],\n      fist_time_array : [],\n      fist_record : [],\n      fist_time_record : [],\n      gait_record : [],\n      gait_time_record : [],\n      chart_data1 : null,\n      chart_data2 : null,\n      chart_data3 : null,\n      wait : false,\n      wait_till : 0,\n      startAt: Date.now(),\n      dead_frame: 0,\n    });\n  }\n\n  sleep = (milliseconds) => {\n    return new Promise(resolve => setTimeout(resolve, milliseconds))\n  }\n\n  async runHandpose() {\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    writeText(ctx, { text: 'Loading', x: 180, y: 70 });\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\n    //const uploadJSONInput = document.getElementById('upload-json');\n    //const uploadWeightsInput = document.getElementById('upload-weights');\n    //const model = await tf.loadLayersModel(tf.io.browserFiles([uploadJSONInput.files[0], uploadWeightsInput.files[0]]));\n    console.log(\"Handpose model loaded.\");\n    this.setState({startAt:Date.now()});\n    const Interval_ID = setInterval(() => {\n      this.read_time_inference(net);\n    }, 40);\n    this.setState({ID:Interval_ID});\n    this.setState({real_time_inferencing:true});\n  };\n\n  async read_time_inference(net) {\n    if (this.state.wait){\n      this.setState({wait_till:Date.now()+3000});\n      //await this.sleep(3000);\n      this.setState({wait:false});\n    }\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n      const ctx = this.canvasRef.current.getContext(\"2d\");\n      this.setState({ctx:ctx});\n\n      //check if hand exist, if yes, drawhand\n      if (hand.length > 0) drawHand(hand, ctx);\n      \n      //check if waiting\n      if (Date.now() < this.state.wait_till){\n        console.log(\"Waiting till \", this.state.wait_till);\n        //count down 3, 2, 1\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, { text: '1', x: 180, y: 70 });\n        else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, { text: '2', x: 180, y: 70 });\n        else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, { text: '3', x: 180, y: 70 });\n      }\n      else {\n        if (hand.length > 0){\n          hand.forEach((prediction) => {\n            this.setState({dead_frame: 0});\n            const landmarks = prediction.landmarks\n\n            let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n            let current_moment = (Date.now() - this.state.startAt)/1000\n\n            if (this.state.finger_done === false){\n              let index_dist = this.norm(landmarks[4], landmarks[8]);\n              index_dist = index_dist/pawn_dist\n              this.setState({pawn_dist_array:[...this.state.pawn_dist_array, pawn_dist]});\n              this.setState({dist_array:[...this.state.dist_array, index_dist]});\n              this.setState({dist_time_array:[...this.state.dist_time_array, current_moment]});\n              let threshold = 0.5;\n              if (this.state.dist_array.length > 20){\n                let j = 1;\n                let avg = 0.0;\n                for (j = 1; j <= 20; j++) avg += this.state.dist_array[this.state.dist_array.length - j];\n                threshold = avg/40.0 + threshold/2.0;\n                console.log(threshold);\n              }\n              if (index_dist >= (threshold + 0.01)){this.setState({index_passed:1})}\n              if (index_dist < (threshold - 0.01) && this.state.index_passed === 1){\n                this.setState({index_passed:0});\n                this.setState({tap_count:[...this.state.tap_count, current_moment]});\n              }\n            }\n            \n            if (this.state.finger_done === true && this.state.rotate_done === false){\n              let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n              this.setState({pawn_rotate_array:[...this.state.pawn_rotate_array, pawn_dist]});\n              this.setState({rotate_array:[...this.state.rotate_array, rotate_dist]});\n              this.setState({rotate_time_array:[...this.state.rotate_time_array, current_moment]});\n              if (this.state.rotate_passed === 0){\n                if (rotate_dist >= 0.25) this.setState({rotate_passed:1});\n                if (rotate_dist <= -0.25) this.setState({rotate_passed:-1});\n              }\n              if (this.state.rotate_passed === 1 && rotate_dist <= -0.5){\n                this.setState({rotate_passed:-1});\n              }\n              if (this.state.rotate_passed === -1 && rotate_dist >= 0.5){\n                this.setState({rotate_passed:1});\n                this.setState({rotate_count:[...this.state.rotate_count, current_moment]});\n              }\n            }\n\n            if (this.state.rotate_done === true && this.state.fist_done === false){\n              let fist_dist =  ((landmarks[8][1] - landmarks[5][1])+\n                                (landmarks[12][1] - landmarks[9][1])+\n                                (landmarks[16][1] - landmarks[13][1])+\n                                (landmarks[20][1] - landmarks[17][1]))/\n                                (4*pawn_dist)\n              this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\n              this.setState({fist_array:[...this.state.fist_array, fist_dist]});\n              this.setState({fist_time_array:[...this.state.fist_time_array, current_moment]});\n              if (fist_dist >= 0.0){this.setState({fist_passed:1})}\n              if (fist_dist < -0.4 && this.state.fist_passed === 1){\n                this.setState({fist_passed:0});\n                this.setState({fist_count:[...this.state.fist_count, current_moment]});\n              }\n            }                  \n          });\n        }\n        else {\n          if (this.state.dead_frame > 9) writeText(ctx, { text: 'Hand Off Screen', x: 180, y: 70 });\n          this.setState({dead_frame: this.state.dead_frame + 1});\n        }\n      }\n    }\n  };\n\n  async stop_tapping() {\n    this.setState({finger_done:true});\n    this.setState({wait:true});\n  }\n\n  async stop_rotating() {\n    this.setState({rotate_done:true});\n    this.setState({wait:true});\n  }\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({real_time_inferencing:false,\n                   finger_done:false,\n                   rotate_done:false,\n                   fist_done:false});\n    this.compose_chart();\n  }\n\n  async record_video(){\n    this.setState({startAt:Date.now()});\n    let count = 0;\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    writeText(ctx, { text: 'Loading', x: 180, y: 70 });\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState({ctx:ctx});\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.concat_frame(count, net, ctx);\n      count = (count + 1)%20;\n    }, 40);\n    this.setState({ID:Interval_ID});\n    this.setState({recording:true});\n  }\n\n  async concat_frame(count, net, ctx) {\n    if (this.state.wait){\n      this.setState({wait_till:Date.now()+3000});\n      //await this.sleep(3000);\n      this.setState({wait:false});\n    }\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      if (Date.now() < this.state.wait_till){\n        console.log(\"Waiting till \", this.state.wait_till);\n        //count down 3, 2, 1\n        ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\n        if (this.state.wait_till - Date.now() < 1000) writeText(ctx, { text: '1', x: 180, y: 70 });\n        else if (this.state.wait_till - Date.now() < 2000) writeText(ctx, { text: '2', x: 180, y: 70 });\n        else if (this.state.wait_till - Date.now() < 3000) writeText(ctx, { text: '3', x: 180, y: 70 });\n        \n      }\n      else {\n        ctx.clearRect(0,0, this.canvasRef.current.width, this.canvasRef.current.height);\n        let current_moment = (Date.now() - this.state.startAt)/1000;\n        const image = this.webcamRef.current.getScreenshot();      \n        var img = document.createElement(\"img\");\n        img.onload = function(){\n          if (this.state.finger_done === false){\n            this.setState({dist_record:[...this.state.dist_record, img]});\n            this.setState({dist_time_record:[...this.state.dist_time_record, current_moment]});\n          }\n\n          else if (this.state.finger_done === true && this.state.rotate_done === false){\n            this.setState({rotate_record:[...this.state.rotate_record, img]});\n            this.setState({rotate_time_record:[...this.state.rotate_time_record, current_moment]});\n          }\n\n          else if (this.state.rotate_done === true && this.state.fist_done === false){\n            this.setState({fist_record:[...this.state.fist_record, img]});\n            this.setState({fist_time_record:[...this.state.fist_time_record, current_moment]});\n          }\n\n          if (count === 0) this.record_estimateHands(img, net, ctx);\n        }.bind(this)\n        img.src = image;\n      }\n    }\n  }\n\n  record_estimateHands = async(img, net, ctx) =>{\n    const hand = await net.estimateHands(img);\n    console.log(hand);\n    if (hand.length > 0) {\n      //drawHand(hand, ctx);   \n      this.setState({dead_frame: 0});\n    }\n    else {\n      if (this.state.dead_frame === 1) writeText(ctx, { text: 'Hand Off Screen', x: 180, y: 70 })\n      this.setState({dead_frame: 1});\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n\n    // Run prediction on recorded tapping data\n    for (let i = 0; i<this.state.dist_record.length; i++){\n      const hand = await net.estimateHands(this.state.dist_record[i]);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let index_dist = this.norm(landmarks[4], landmarks[8]);\n          index_dist = index_dist/pawn_dist\n          let threshold = 0.5;\n          if (i > 20){\n            let j = 1;\n            let avg = 0.0;\n            for (j = 1; j <= 20; j++) avg += this.state.dist_array[i - j];\n            threshold = avg/40.0 + threshold/2.0;\n            console.log(threshold);\n          }\n          this.setState({pawn_dist_array:[...this.state.pawn_dist_array, pawn_dist]});\n          this.setState({dist_array:[...this.state.dist_array, index_dist]});\n          this.setState({dist_time_array:[...this.state.dist_time_array, this.state.dist_time_record[i]]});\n          if (index_dist >= (threshold + 0.125)){this.setState({index_passed:1})}\n          if (index_dist < (threshold - 0.125) && this.state.index_passed === 1){\n            this.setState({index_passed:0});\n            this.setState({tap_count:[...this.state.tap_count, this.state.dist_time_record[i]]});\n          }\n          console.log(\"INDEX COUNT:\", this.state.tap_count);\n        });\n      }\n    }\n\n    // Run prediction on recorded rotation data\n    for (let i = 0; i<this.state.rotate_record.length; i++){\n      const hand = await net.estimateHands(this.state.rotate_record[i]);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n          this.setState({pawn_rotate_array:[...this.state.pawn_rotate_array, pawn_dist]});\n          this.setState({rotate_array:[...this.state.rotate_array, rotate_dist]});\n          this.setState({rotate_time_array:[...this.state.rotate_time_array, this.state.rotate_time_record[i]]});\n          if (this.state.rotate_passed === 0){\n            if (rotate_dist >= 0.5) this.setState({rotate_passed:1});\n            if (rotate_dist <= -0.5) this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5){\n            this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5){\n            this.setState({rotate_passed:1});\n            this.setState({rotate_count:[...this.state.rotate_count, this.state.rotate_time_record[i]]});\n          }\n          console.log(\"ROTATE COUNT:\", this.state.rotate_count);\n        });\n      }\n    }\n\n    // Run prediction on recorded gripping data\n    for (let i = 0; i<this.state.fist_record.length; i++){\n      const hand = await net.estimateHands(this.state.fist_record[i]);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n          let pawn_dist = this.norm(landmarks[0], landmarks[17]);\n          let fist_dist =  ((landmarks[8][1] - landmarks[5][1])+\n            (landmarks[12][1] - landmarks[9][1])+\n            (landmarks[16][1] - landmarks[13][1])+\n            (landmarks[20][1] - landmarks[17][1]))/\n            (4*pawn_dist)\n          this.setState({pawn_fist_array:[...this.state.pawn_fist_array, pawn_dist]});\n          this.setState({fist_array:[...this.state.fist_array, fist_dist]});\n          this.setState({fist_time_array:[...this.state.fist_time_array, this.state.fist_time_record[i]]});\n          if (fist_dist >= 0.0){this.setState({fist_passed:1})}\n          if (fist_dist < -0.4 && this.state.fist_passed === 1){\n            this.setState({fist_passed:0});\n            this.setState({fist_count:[...this.state.fist_count, this.state.fist_time_record[i]]});\n          }\n          console.log(\"FIST COUNT:\", this.state.fist_count);\n        });\n      }\n    }\n    this.setState({record:[]});\n  }\n\n  async stop_record() {\n    clearInterval(this.state.ID);\n    await this.inference();\n    this.setState({recording:false,\n      finger_done:false,\n      rotate_done:false,\n      fist_done:false});\n    this.compose_chart();\n  }\n\n  \n\n  render(){\n    const videoConstraints = {\n      facingMode: this.state.facingMode\n    };\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n        <Webcam\n          ref={this.webcamRef}\n          videoConstraints={videoConstraints}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\",\n          }}\n        />\n        <canvas\n          ref={this.canvasRef}\n          style={{\n            position: \"absolute\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            left: 0,\n            right: 0,\n            textAlign: \"center\",\n            zindex: 9,\n            width: \"auto\",\n            height: \"auto\",\n          }}\n        />\n        </header>\n          {this.state.button_mode ? (\n            <div>\n              <button onClick={this.increment_tap1} id=\"button1\">Index Finger</button>\n              <button onClick={this.increment_tap2} id=\"button2\">Middle Finger</button>\n            </div>\n          ) : (\n            <div></div>\n          )}\n\n          <div>\n            {this.state.real_time_inferencing ? (\n              this.state.finger_done ? (\n                this.state.rotate_done ? (\n                  <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_real_time_inference}>Calculate Result</Button>\n                ):(\n                  <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_rotating}>Finish Rotating</Button>\n                )\n              ):(\n                <Button variant=\"contained\" color=\"primary\"  onClick={this.stop_tapping}>Finish Tapping</Button>\n              )            \n            ) : (\n            <Button disabled={this.state.recording} variant=\"contained\" color=\"primary\"  onClick={this.runHandpose}>Starting Real Time Inference</Button>\n            )}\n\n            {this.state.recording ? (\n              this.state.finger_done ? (\n                this.state.rotate_done ? (\n                  <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_record}>Calculate Result</Button>\n                ):(\n                  <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_rotating}>Finish Rotating</Button>\n                )\n              ):(\n                <Button variant=\"contained\" color=\"secondary\" onClick={this.stop_tapping}>Finish Tapping</Button>\n              )            \n            ) : (\n            <Button disabled={this.state.real_time_inferencing} variant=\"contained\" color=\"secondary\" onClick={this.record_video}>Starting Recording</Button>\n            )}\n\n            <Button disabled={this.state.recording||this.state.real_time_inferencing} variant=\"outlined\" color=\"secondary\" onClick={this.reset_counter}>\n              Reset All\n            </Button>\n          </div>\n          \n          <input type=\"number\" id=\"real_measurement\" onChange={this.compose_chart} step=\"0.001\" min='0' max='20'></input>\n          <button disabled={!this.state.chart_ready} onClick={this.switch_style}>Switch Chart Style</button>\n          <button onClick={this.switch_cam}>Switch Camera</button>\n          <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.runPosenet}>PoseNet</button>\n          <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.runFacemesh}>Facemesh</button>\n          <button disabled={this.state.recording||this.state.real_time_inferencing} onClick={this.switch_button}>Switch On/Off Button</button>       \n            <h5>\n              Finger Tapping Count:{this.state.tap_count.length}&nbsp;&nbsp;&nbsp;&nbsp;\n              Rotate Count:{this.state.rotate_count.length}&nbsp;&nbsp;&nbsp;&nbsp;\n              Gripping Count: {this.state.fist_count.length}\n            </h5>\n          <div>\n            {this.state.chart_ready ? (\n              <div>\n                <Line data={this.state.chart_data1} />\n                <Line data={this.state.chart_data2} />\n                <Line data={this.state.chart_data3} />\n              </div>\n            ) : (\n              <div/>\n            )}\n            <div>\n              <input type=\"file\" id=\"upload-json\"></input>\n            </div>\n            <div>\n              <input type=\"file\" id=\"upload-weights\"></input>\n            </div>\n          </div>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}