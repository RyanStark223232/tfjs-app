{"ast":null,"code":"/**\r\n * @license\r\n * Copyright 2018 Google LLC. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n * =============================================================================\r\n */\nimport { env } from '@tensorflow/tfjs-core';\nexport function getGlslDifferences() {\n  let version;\n  let attribute;\n  let varyingVs;\n  let varyingFs;\n  let texture2D;\n  let output;\n  let defineOutput;\n  let defineSpecialNaN;\n  let defineSpecialInf;\n  let defineRound;\n\n  if (env().getNumber('WEBGL_VERSION') === 2) {\n    version = '#version 300 es';\n    attribute = 'in';\n    varyingVs = 'out';\n    varyingFs = 'in';\n    texture2D = 'texture';\n    output = 'outputColor';\n    defineOutput = 'out vec4 outputColor;'; // Use custom isnan definition to work across differences between\n    // implementations on various platforms. While this should happen in ANGLE\n    // we still see differences between android and windows (on chrome) when\n    // using isnan directly.\n\n    defineSpecialNaN = `\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    `; // In webgl 2 we do not need to specify a custom isinf so there is no\n    // need for a special INFINITY constant.\n\n    defineSpecialInf = ``;\n    defineRound = `\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    `;\n  } else {\n    version = '';\n    attribute = 'attribute';\n    varyingVs = 'varying';\n    varyingFs = 'varying';\n    texture2D = 'texture2D';\n    output = 'gl_FragColor';\n    defineOutput = ''; // WebGL1 has no built in isnan so we define one here.\n\n    defineSpecialNaN = `\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    `;\n    defineSpecialInf = `\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    `;\n    defineRound = `\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    `;\n  }\n\n  return {\n    version,\n    attribute,\n    varyingVs,\n    varyingFs,\n    texture2D,\n    output,\n    defineOutput,\n    defineSpecialNaN,\n    defineSpecialInf,\n    defineRound\n  };\n}","map":{"version":3,"sources":["../src/glsl_version.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;AAeG;AACH,SAAQ,GAAR,QAAkB,uBAAlB;AAeA,OAAM,SAAU,kBAAV,GAA4B;AAChC,MAAI,OAAJ;AACA,MAAI,SAAJ;AACA,MAAI,SAAJ;AACA,MAAI,SAAJ;AACA,MAAI,SAAJ;AACA,MAAI,MAAJ;AACA,MAAI,YAAJ;AACA,MAAI,gBAAJ;AACA,MAAI,gBAAJ;AACA,MAAI,WAAJ;;AAEA,MAAI,GAAG,GAAG,SAAN,CAAgB,eAAhB,MAAqC,CAAzC,EAA4C;AAC1C,IAAA,OAAO,GAAG,iBAAV;AACA,IAAA,SAAS,GAAG,IAAZ;AACA,IAAA,SAAS,GAAG,KAAZ;AACA,IAAA,SAAS,GAAG,IAAZ;AACA,IAAA,SAAS,GAAG,SAAZ;AACA,IAAA,MAAM,GAAG,aAAT;AACA,IAAA,YAAY,GAAG,uBAAf,CAP0C,CAS1C;AACA;AACA;AACA;;AACA,IAAA,gBAAgB,GAAG;;;;;;;;;;;AAWlB,KAXD,CAb0C,CAyB1C;AACA;;AACA,IAAA,gBAAgB,GAAG,EAAnB;AACA,IAAA,WAAW,GAAG;;;;;;;;;AASb,KATD;AAUD,GAtCD,MAsCO;AACL,IAAA,OAAO,GAAG,EAAV;AACA,IAAA,SAAS,GAAG,WAAZ;AACA,IAAA,SAAS,GAAG,SAAZ;AACA,IAAA,SAAS,GAAG,SAAZ;AACA,IAAA,SAAS,GAAG,WAAZ;AACA,IAAA,MAAM,GAAG,cAAT;AACA,IAAA,YAAY,GAAG,EAAf,CAPK,CAQL;;AACA,IAAA,gBAAgB,GAAG;;;;;;;;AAQlB,KARD;AASA,IAAA,gBAAgB,GAAG;;;;;;;;;AASlB,KATD;AAUA,IAAA,WAAW,GAAG;;;;;;;;AAQb,KARD;AASD;;AAED,SAAO;AACL,IAAA,OADK;AAEL,IAAA,SAFK;AAGL,IAAA,SAHK;AAIL,IAAA,SAJK;AAKL,IAAA,SALK;AAML,IAAA,MANK;AAOL,IAAA,YAPK;AAQL,IAAA,gBARK;AASL,IAAA,gBATK;AAUL,IAAA;AAVK,GAAP;AAYD","sourceRoot":"","sourcesContent":["/**\r\n * @license\r\n * Copyright 2018 Google LLC. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n * =============================================================================\r\n */\r\nimport { env } from '@tensorflow/tfjs-core';\r\nexport function getGlslDifferences() {\r\n    let version;\r\n    let attribute;\r\n    let varyingVs;\r\n    let varyingFs;\r\n    let texture2D;\r\n    let output;\r\n    let defineOutput;\r\n    let defineSpecialNaN;\r\n    let defineSpecialInf;\r\n    let defineRound;\r\n    if (env().getNumber('WEBGL_VERSION') === 2) {\r\n        version = '#version 300 es';\r\n        attribute = 'in';\r\n        varyingVs = 'out';\r\n        varyingFs = 'in';\r\n        texture2D = 'texture';\r\n        output = 'outputColor';\r\n        defineOutput = 'out vec4 outputColor;';\r\n        // Use custom isnan definition to work across differences between\r\n        // implementations on various platforms. While this should happen in ANGLE\r\n        // we still see differences between android and windows (on chrome) when\r\n        // using isnan directly.\r\n        defineSpecialNaN = `\r\n      bool isnan_custom(float val) {\r\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\r\n      }\r\n\r\n      bvec4 isnan_custom(vec4 val) {\r\n        return bvec4(isnan_custom(val.x),\r\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\r\n      }\r\n\r\n      #define isnan(value) isnan_custom(value)\r\n    `;\r\n        // In webgl 2 we do not need to specify a custom isinf so there is no\r\n        // need for a special INFINITY constant.\r\n        defineSpecialInf = ``;\r\n        defineRound = `\r\n      #define round(value) newRound(value)\r\n      int newRound(float value) {\r\n        return int(floor(value + 0.5));\r\n      }\r\n\r\n      ivec4 newRound(vec4 value) {\r\n        return ivec4(floor(value + vec4(0.5)));\r\n      }\r\n    `;\r\n    }\r\n    else {\r\n        version = '';\r\n        attribute = 'attribute';\r\n        varyingVs = 'varying';\r\n        varyingFs = 'varying';\r\n        texture2D = 'texture2D';\r\n        output = 'gl_FragColor';\r\n        defineOutput = '';\r\n        // WebGL1 has no built in isnan so we define one here.\r\n        defineSpecialNaN = `\r\n      #define isnan(value) isnan_custom(value)\r\n      bool isnan_custom(float val) {\r\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\r\n      }\r\n      bvec4 isnan_custom(vec4 val) {\r\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\r\n      }\r\n    `;\r\n        defineSpecialInf = `\r\n      uniform float INFINITY;\r\n\r\n      bool isinf(float val) {\r\n        return abs(val) == INFINITY;\r\n      }\r\n      bvec4 isinf(vec4 val) {\r\n        return equal(abs(val), vec4(INFINITY));\r\n      }\r\n    `;\r\n        defineRound = `\r\n      int round(float value) {\r\n        return int(floor(value + 0.5));\r\n      }\r\n\r\n      ivec4 round(vec4 value) {\r\n        return ivec4(floor(value + vec4(0.5)));\r\n      }\r\n    `;\r\n    }\r\n    return {\r\n        version,\r\n        attribute,\r\n        varyingVs,\r\n        varyingFs,\r\n        texture2D,\r\n        output,\r\n        defineOutput,\r\n        defineSpecialNaN,\r\n        defineSpecialInf,\r\n        defineRound\r\n    };\r\n}\r\n//# sourceMappingURL=glsl_version.js.map"]},"metadata":{},"sourceType":"module"}