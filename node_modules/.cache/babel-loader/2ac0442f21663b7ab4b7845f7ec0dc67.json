{"ast":null,"code":"import _toConsumableArray from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/wongh/finger/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/wongh/finger/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React from\"react\";// import logo from './logo.svg';\n//import * as tf from \"@tensorflow/tfjs-core\";\nimport*as handpose from\"@tensorflow-models/handpose\";import Webcam from\"react-webcam\";import\"./App.css\";import{drawHand}from\"./utilities\";import{sqrt,pow}from\"mathjs\";var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.state={count:0,passed:0,record:[],ID:0,real_time_inferencing:false,recording:false};_this.webcamRef=/*#__PURE__*/React.createRef(null);_this.canvasRef=/*#__PURE__*/React.createRef(null);_this.runHandpose=_this.runHandpose.bind(_assertThisInitialized(_this));_this.stop_real_time_inference=_this.stop_real_time_inference.bind(_assertThisInitialized(_this));_this.stop_record=_this.stop_record.bind(_assertThisInitialized(_this));_this.record_video=_this.record_video.bind(_assertThisInitialized(_this));_this.concat_frame=_this.concat_frame.bind(_assertThisInitialized(_this));_this.inference=_this.inference.bind(_assertThisInitialized(_this));_this.reset_counter=_this.reset_counter.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"reset_counter\",value:function reset_counter(){this.setState({count:0});}},{key:\"runHandpose\",value:function(){var _runHandpose=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this2=this;var net,Interval_ID;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:require('@tensorflow/tfjs-backend-webgl');_context.next=3;return handpose.load();case 3:net=_context.sent;console.log(\"Handpose model loaded.\");Interval_ID=setInterval(function(){_this2.read_time_inference(net);},50);this.setState({ID:Interval_ID});this.setState({real_time_inferencing:true});case 8:case\"end\":return _context.stop();}}},_callee,this);}));function runHandpose(){return _runHandpose.apply(this,arguments);}return runHandpose;}()},{key:\"read_time_inference\",value:function(){var _read_time_inference=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(net){var _this3=this;var video,videoWidth,videoHeight,hand;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(typeof this.webcamRef.current!==\"undefined\"&&this.webcamRef.current!==null&&this.webcamRef.current.video.readyState===4)){_context2.next=12;break;}video=this.webcamRef.current.video;videoWidth=this.webcamRef.current.video.videoWidth;videoHeight=this.webcamRef.current.video.videoHeight;this.webcamRef.current.video.width=videoWidth;this.webcamRef.current.video.height=videoHeight;this.canvasRef.current.width=videoWidth;this.canvasRef.current.height=videoHeight;_context2.next=10;return net.estimateHands(video);case 10:hand=_context2.sent;if(hand.length>0){hand.forEach(function(prediction){var landmarks=prediction.landmarks;var finger_dist=sqrt(pow(landmarks[8][0]-landmarks[4][0],2)+pow(landmarks[8][1]-landmarks[4][1],2));var pawn_dist=sqrt(pow(landmarks[0][0]-landmarks[2][0],2)+pow(landmarks[0][1]-landmarks[2][1],2));finger_dist=finger_dist/pawn_dist;if(finger_dist>=0.5){_this3.setState({passed:1});}if(finger_dist<0.5&&_this3.state.passed===1){_this3.setState({passed:0});_this3.setState({count:_this3.state.count+1});}console.log(\"passed:\",_this3.state.passed,\"count:\",_this3.state.count);var ctx=_this3.canvasRef.current.getContext(\"2d\");_this3.setState({context:ctx});drawHand(hand,ctx);});}case 12:case\"end\":return _context2.stop();}}},_callee2,this);}));function read_time_inference(_x){return _read_time_inference.apply(this,arguments);}return read_time_inference;}()},{key:\"stop_real_time_inference\",value:function stop_real_time_inference(){clearInterval(this.state.ID);this.setState({real_time_inferencing:false});}},{key:\"record_video\",value:function(){var _record_video=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this4=this;var Interval_ID;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:Interval_ID=setInterval(function(){_this4.concat_frame();},50);this.setState({ID:Interval_ID});this.setState({recording:true});case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function record_video(){return _record_video.apply(this,arguments);}return record_video;}()},{key:\"concat_frame\",value:function(){var _concat_frame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var image,img;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(typeof this.webcamRef.current!==\"undefined\"&&this.webcamRef.current!==null&&this.webcamRef.current.video.readyState===4){image=this.webcamRef.current.getScreenshot();img=document.createElement(\"img\");img.onload=function(){this.setState({record:[].concat(_toConsumableArray(this.state.record),[img])});console.log(this.state.record,this.state.recording);}.bind(this);img.src=image;}case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function concat_frame(){return _concat_frame.apply(this,arguments);}return concat_frame;}()},{key:\"inference\",value:function(){var _inference=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _this5=this;var net,i,hand;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:require('@tensorflow/tfjs-backend-webgl');_context5.next=3;return handpose.load();case 3:net=_context5.sent;console.log(\"Handpose model loaded.\");i=0;case 6:if(!(i<this.state.record.length)){_context5.next=15;break;}_context5.next=9;return net.estimateHands(this.state.record[i]);case 9:hand=_context5.sent;console.log(hand);if(hand.length>0){hand.forEach(function(prediction){var landmarks=prediction.landmarks;var finger_dist=sqrt(pow(landmarks[8][0]-landmarks[4][0],2)+pow(landmarks[8][1]-landmarks[4][1],2));var pawn_dist=sqrt(pow(landmarks[0][0]-landmarks[2][0],2)+pow(landmarks[0][1]-landmarks[2][1],2));finger_dist=finger_dist/pawn_dist;if(finger_dist>=0.5){_this5.setState({passed:1});}if(finger_dist<0.5&&_this5.state.passed===1){_this5.setState({passed:0});_this5.setState({count:_this5.state.count+1});}console.log(\"passed:\",_this5.state.passed,\"count:\",_this5.state.count);});}case 12:i++;_context5.next=6;break;case 15:case\"end\":return _context5.stop();}}},_callee5,this);}));function inference(){return _inference.apply(this,arguments);}return inference;}()},{key:\"stop_record\",value:function stop_record(){clearInterval(this.state.ID);this.inference();this.setState({recording:false});}/*\n  <Webcam\n  ref={this.webcamRef}\n  style={{\n    position: \"absolute\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    left: 0,\n    right: 0,\n    textAlign: \"center\",\n    zindex: 9,\n    width: \"auto\",\n    height: \"auto\",\n  }}\n/>\n<canvas\n  ref={this.canvasRef}\n  style={{\n    position: \"absolute\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    left: 0,\n    right: 0,\n    textAlign: \"center\",\n    zindex: 9,\n    width: \"auto\",\n    height: \"auto\",\n  }}\n/>*/},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[this.state.real_time_inferencing?/*#__PURE__*/_jsx(\"button\",{onClick:this.stop_real_time_inference,children:\"Stopping Real Time Inference\"}):/*#__PURE__*/_jsx(\"button\",{onClick:this.runHandpose,children:\"Starting Real Time Inference\"}),this.state.recording?/*#__PURE__*/_jsx(\"button\",{onClick:this.stop_record,children:\"Stopping Recording\"}):/*#__PURE__*/_jsx(\"button\",{onClick:this.record_video,children:\"Starting Recording\"}),/*#__PURE__*/_jsx(\"button\",{onClick:this.reset_counter,children:\"Reset Counter\"}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Finger Tapping Count: \",this.state.count]})]})});}}]);return App;}(React.Component);export default App;","map":{"version":3,"sources":["C:/Users/wongh/finger/src/App.js"],"names":["React","handpose","Webcam","drawHand","sqrt","pow","App","props","state","count","passed","record","ID","real_time_inferencing","recording","webcamRef","createRef","canvasRef","runHandpose","bind","stop_real_time_inference","stop_record","record_video","concat_frame","inference","reset_counter","setState","require","load","net","console","log","Interval_ID","setInterval","read_time_inference","current","video","readyState","videoWidth","videoHeight","width","height","estimateHands","hand","length","forEach","prediction","landmarks","finger_dist","pawn_dist","ctx","getContext","context","clearInterval","image","getScreenshot","img","document","createElement","onload","src","i","Component"],"mappings":"65BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA;AACA;AACA,MAAO,GAAKC,CAAAA,QAAZ,KAA0B,6BAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,cAAnB,CACA,MAAO,WAAP,CACA,OAASC,QAAT,KAAyB,aAAzB,CACA,OAASC,IAAT,CAAeC,GAAf,KAA0B,QAA1B,C,GAEMC,CAAAA,G,sGACJ,aAAYC,KAAZ,CAAmB,qCACjB,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CACXC,KAAK,CAAG,CADG,CAEXC,MAAM,CAAG,CAFE,CAGXC,MAAM,CAAG,EAHE,CAIXC,EAAE,CAAG,CAJM,CAKXC,qBAAqB,CAAC,KALX,CAMXC,SAAS,CAAC,KANC,CAAb,CAQA,MAAKC,SAAL,cAAiBf,KAAK,CAACgB,SAAN,CAAgB,IAAhB,CAAjB,CACA,MAAKC,SAAL,cAAiBjB,KAAK,CAACgB,SAAN,CAAgB,IAAhB,CAAjB,CACA,MAAKE,WAAL,CAAmB,MAAKA,WAAL,CAAiBC,IAAjB,+BAAnB,CACA,MAAKC,wBAAL,CAAgC,MAAKA,wBAAL,CAA8BD,IAA9B,+BAAhC,CACA,MAAKE,WAAL,CAAmB,MAAKA,WAAL,CAAiBF,IAAjB,+BAAnB,CACA,MAAKG,YAAL,CAAoB,MAAKA,YAAL,CAAkBH,IAAlB,+BAApB,CACA,MAAKI,YAAL,CAAoB,MAAKA,YAAL,CAAkBJ,IAAlB,+BAApB,CACA,MAAKK,SAAL,CAAiB,MAAKA,SAAL,CAAeL,IAAf,+BAAjB,CACA,MAAKM,aAAL,CAAqB,MAAKA,aAAL,CAAmBN,IAAnB,+BAArB,CAlBiB,aAmBlB,C,qEAEc,CACb,KAAKO,QAAL,CAAc,CAACjB,KAAK,CAAC,CAAP,CAAd,EACD,C,sRAGCkB,OAAO,CAAC,gCAAD,CAAP,C,sBACkB1B,CAAAA,QAAQ,CAAC2B,IAAT,E,QAAZC,G,eACNC,OAAO,CAACC,GAAR,CAAY,wBAAZ,EACMC,W,CAAcC,WAAW,CAAC,UAAM,CACpC,MAAI,CAACC,mBAAL,CAAyBL,GAAzB,EACD,CAF8B,CAE5B,EAF4B,C,CAG/B,KAAKH,QAAL,CAAc,CAACd,EAAE,CAACoB,WAAJ,CAAd,EACA,KAAKN,QAAL,CAAc,CAACb,qBAAqB,CAAC,IAAvB,CAAd,E,uSAGwBgB,G,iLAEtB,MAAO,MAAKd,SAAL,CAAeoB,OAAtB,GAAkC,WAAlC,EACA,KAAKpB,SAAL,CAAeoB,OAAf,GAA2B,IAD3B,EAEA,KAAKpB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BC,UAA7B,GAA4C,C,4BAEtCD,K,CAAQ,KAAKrB,SAAL,CAAeoB,OAAf,CAAuBC,K,CAC/BE,U,CAAa,KAAKvB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BE,U,CAC1CC,W,CAAc,KAAKxB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BG,W,CACjD,KAAKxB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BI,KAA7B,CAAqCF,UAArC,CACA,KAAKvB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BK,MAA7B,CAAsCF,WAAtC,CACA,KAAKtB,SAAL,CAAekB,OAAf,CAAuBK,KAAvB,CAA+BF,UAA/B,CACA,KAAKrB,SAAL,CAAekB,OAAf,CAAuBM,MAAvB,CAAgCF,WAAhC,C,wBACmBV,CAAAA,GAAG,CAACa,aAAJ,CAAkBN,KAAlB,C,SAAbO,I,gBACN,GAAIA,IAAI,CAACC,MAAL,CAAc,CAAlB,CAAoB,CAClBD,IAAI,CAACE,OAAL,CAAa,SAACC,UAAD,CAAgB,CAC3B,GAAMC,CAAAA,SAAS,CAAGD,UAAU,CAACC,SAA7B,CACA,GAAIC,CAAAA,WAAW,CAAG5C,IAAI,CAACC,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAAH,CAAwC1C,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAA5C,CAAtB,CACA,GAAIE,CAAAA,SAAS,CAAG7C,IAAI,CAACC,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAAH,CAAwC1C,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAA5C,CAApB,CACAC,WAAW,CAAGA,WAAW,CAACC,SAA1B,CACA,GAAID,WAAW,EAAI,GAAnB,CAAuB,CAAC,MAAI,CAACtB,QAAL,CAAc,CAAChB,MAAM,CAAC,CAAR,CAAd,EAA0B,CAClD,GAAIsC,WAAW,CAAG,GAAd,EAAqB,MAAI,CAACxC,KAAL,CAAWE,MAAX,GAAsB,CAA/C,CAAiD,CAC/C,MAAI,CAACgB,QAAL,CAAc,CAAChB,MAAM,CAAC,CAAR,CAAd,EACA,MAAI,CAACgB,QAAL,CAAc,CAACjB,KAAK,CAAC,MAAI,CAACD,KAAL,CAAWC,KAAX,CAAiB,CAAxB,CAAd,EACD,CACDqB,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB,MAAI,CAACvB,KAAL,CAAWE,MAAlC,CAA0C,QAA1C,CAAoD,MAAI,CAACF,KAAL,CAAWC,KAA/D,EACA,GAAMyC,CAAAA,GAAG,CAAG,MAAI,CAACjC,SAAL,CAAekB,OAAf,CAAuBgB,UAAvB,CAAkC,IAAlC,CAAZ,CACA,MAAI,CAACzB,QAAL,CAAc,CAAC0B,OAAO,CAACF,GAAT,CAAd,EACA/C,QAAQ,CAACwC,IAAD,CAAOO,GAAP,CAAR,CACD,CAdD,EAeD,C,8PAIsB,CACzBG,aAAa,CAAC,KAAK7C,KAAL,CAAWI,EAAZ,CAAb,CACA,KAAKc,QAAL,CAAc,CAACb,qBAAqB,CAAC,KAAvB,CAAd,EACD,C,yRAGOmB,W,CAAcC,WAAW,CAAC,UAAM,CACpC,MAAI,CAACV,YAAL,GACD,CAF8B,CAE5B,EAF4B,C,CAG/B,KAAKG,QAAL,CAAc,CAACd,EAAE,CAACoB,WAAJ,CAAd,EACA,KAAKN,QAAL,CAAc,CAACZ,SAAS,CAAC,IAAX,CAAd,E,kaAIA,GACE,MAAO,MAAKC,SAAL,CAAeoB,OAAtB,GAAkC,WAAlC,EACA,KAAKpB,SAAL,CAAeoB,OAAf,GAA2B,IAD3B,EAEA,KAAKpB,SAAL,CAAeoB,OAAf,CAAuBC,KAAvB,CAA6BC,UAA7B,GAA4C,CAH9C,CAIE,CACMiB,KADN,CACc,KAAKvC,SAAL,CAAeoB,OAAf,CAAuBoB,aAAvB,EADd,CAEIC,GAFJ,CAEUC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAFV,CAGAF,GAAG,CAACG,MAAJ,CAAa,UAAU,CACrB,KAAKjC,QAAL,CAAc,CAACf,MAAM,8BAAK,KAAKH,KAAL,CAAWG,MAAhB,GAAwB6C,GAAxB,EAAP,CAAd,EACA1B,OAAO,CAACC,GAAR,CAAY,KAAKvB,KAAL,CAAWG,MAAvB,CAA+B,KAAKH,KAAL,CAAWM,SAA1C,EACD,CAHY,CAGXK,IAHW,CAGN,IAHM,CAAb,CAIAqC,GAAG,CAACI,GAAJ,CAAUN,KAAV,CACD,C,6aAID3B,OAAO,CAAC,gCAAD,CAAP,C,uBACkB1B,CAAAA,QAAQ,CAAC2B,IAAT,E,QAAZC,G,gBACNC,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAEK8B,CAAC,CAAG,C,aAAGA,CAAC,CAAC,KAAKrD,KAAL,CAAWG,MAAX,CAAkBiC,M,mDACXf,CAAAA,GAAG,CAACa,aAAJ,CAAkB,KAAKlC,KAAL,CAAWG,MAAX,CAAkBkD,CAAlB,CAAlB,C,QAAblB,I,gBACNb,OAAO,CAACC,GAAR,CAAYY,IAAZ,EACA,GAAIA,IAAI,CAACC,MAAL,CAAc,CAAlB,CAAoB,CAClBD,IAAI,CAACE,OAAL,CAAa,SAACC,UAAD,CAAgB,CAC3B,GAAMC,CAAAA,SAAS,CAAGD,UAAU,CAACC,SAA7B,CACA,GAAIC,CAAAA,WAAW,CAAG5C,IAAI,CAACC,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAAH,CAAwC1C,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAA5C,CAAtB,CACA,GAAIE,CAAAA,SAAS,CAAG7C,IAAI,CAACC,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAAH,CAAwC1C,GAAG,CAAC0C,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,EAAgBA,SAAS,CAAC,CAAD,CAAT,CAAa,CAAb,CAAjB,CAAkC,CAAlC,CAA5C,CAApB,CACAC,WAAW,CAAGA,WAAW,CAACC,SAA1B,CACA,GAAID,WAAW,EAAI,GAAnB,CAAuB,CAAC,MAAI,CAACtB,QAAL,CAAc,CAAChB,MAAM,CAAC,CAAR,CAAd,EAA0B,CAClD,GAAIsC,WAAW,CAAG,GAAd,EAAqB,MAAI,CAACxC,KAAL,CAAWE,MAAX,GAAsB,CAA/C,CAAiD,CAC/C,MAAI,CAACgB,QAAL,CAAc,CAAChB,MAAM,CAAC,CAAR,CAAd,EACA,MAAI,CAACgB,QAAL,CAAc,CAACjB,KAAK,CAAC,MAAI,CAACD,KAAL,CAAWC,KAAX,CAAiB,CAAxB,CAAd,EACD,CACDqB,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB,MAAI,CAACvB,KAAL,CAAWE,MAAlC,CAA0C,QAA1C,CAAoD,MAAI,CAACF,KAAL,CAAWC,KAA/D,EACD,CAXD,EAYD,C,QAhBqCoD,CAAC,E,4NAoB7B,CACZR,aAAa,CAAC,KAAK7C,KAAL,CAAWI,EAAZ,CAAb,CACA,KAAKY,SAAL,GACA,KAAKE,QAAL,CAAc,CAACZ,SAAS,CAAC,KAAX,CAAd,EACD,CACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I,uCACU,CACN,mBACE,YAAK,SAAS,CAAC,KAAf,uBACE,gBAAQ,SAAS,CAAC,YAAlB,WACG,KAAKN,KAAL,CAAWK,qBAAX,cACD,eAAQ,OAAO,CAAE,KAAKO,wBAAtB,0CADC,cAGD,eAAQ,OAAO,CAAE,KAAKF,WAAtB,0CAJF,CAOG,KAAKV,KAAL,CAAWM,SAAX,cACD,eAAQ,OAAO,CAAE,KAAKO,WAAtB,gCADC,cAGD,eAAQ,OAAO,CAAE,KAAKC,YAAtB,gCAVF,cAaE,eAAQ,OAAO,CAAE,KAAKG,aAAtB,2BAbF,cAeE,+CACyB,KAAKjB,KAAL,CAAWC,KADpC,GAfF,GADF,EADF,CAuBD,C,iBAvLeT,KAAK,CAAC8D,S,EA0LxB,cAAexD,CAAAA,GAAf","sourcesContent":["import React from \"react\";\n// import logo from './logo.svg';\n//import * as tf from \"@tensorflow/tfjs-core\";\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\"\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      count : 0,\n      passed : 0,\n      record : [],\n      ID : 0,\n      real_time_inferencing:false,\n      recording:false,\n    };\n    this.webcamRef = React.createRef(null);\n    this.canvasRef = React.createRef(null);\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n  }\n\n  reset_counter(){\n    this.setState({count:0});\n  }\n\n  async runHandpose() {    \n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.read_time_inference(net);\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({real_time_inferencing:true});\n  };\n\n  async read_time_inference(net) {\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n          let finger_dist = sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n          let pawn_dist = sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n          finger_dist = finger_dist/pawn_dist          \n          if (finger_dist >= 0.5){this.setState({passed:1})}\n          if (finger_dist < 0.5 && this.state.passed === 1){\n            this.setState({passed:0});\n            this.setState({count:this.state.count+1});\n          }\n          console.log(\"passed:\", this.state.passed, \"count:\", this.state.count)\n          const ctx = this.canvasRef.current.getContext(\"2d\");\n          this.setState({context:ctx});\n          drawHand(hand, ctx);\n        });\n      }      \n    }\n  };\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({real_time_inferencing:false});\n  }\n\n  async record_video(){    \n    const Interval_ID = setInterval(() => {\n      this.concat_frame();\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({recording:true});\n  }\n\n  async concat_frame() {\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const image = this.webcamRef.current.getScreenshot();      \n      var img = document.createElement(\"img\");\n      img.onload = function(){\n        this.setState({record:[...this.state.record, img]});\n        console.log(this.state.record, this.state.recording);\n      }.bind(this)\n      img.src = image;\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    var i;\n    for (i = 0; i<this.state.record.length; i++){\n      const hand = await net.estimateHands(this.state.record[i]);\n      console.log(hand);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n          let finger_dist = sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n          let pawn_dist = sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n          finger_dist = finger_dist/pawn_dist          \n          if (finger_dist >= 0.5){this.setState({passed:1})}\n          if (finger_dist < 0.5 && this.state.passed === 1){\n            this.setState({passed:0});\n            this.setState({count:this.state.count+1});\n          }\n          console.log(\"passed:\", this.state.passed, \"count:\", this.state.count)\n        });\n      }\n    }\n  }\n\n  stop_record() {\n    clearInterval(this.state.ID);\n    this.inference();\n    this.setState({recording:false});\n  }\n/*\n  <Webcam\n  ref={this.webcamRef}\n  style={{\n    position: \"absolute\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    left: 0,\n    right: 0,\n    textAlign: \"center\",\n    zindex: 9,\n    width: \"auto\",\n    height: \"auto\",\n  }}\n/>\n<canvas\n  ref={this.canvasRef}\n  style={{\n    position: \"absolute\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    left: 0,\n    right: 0,\n    textAlign: \"center\",\n    zindex: 9,\n    width: \"auto\",\n    height: \"auto\",\n  }}\n/>*/\n  render(){\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          {this.state.real_time_inferencing ? (\n          <button onClick={this.stop_real_time_inference}>Stopping Real Time Inference</button>\n          ) : (\n          <button onClick={this.runHandpose}>Starting Real Time Inference</button>\n          )}\n\n          {this.state.recording ? (\n          <button onClick={this.stop_record}>Stopping Recording</button>\n          ) : (\n          <button onClick={this.record_video}>Starting Recording</button>\n          )}\n\n          <button onClick={this.reset_counter}>Reset Counter</button>\n          \n          <h4>\n            Finger Tapping Count: {this.state.count}\n          </h4>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}