{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\wongh\\\\finger\\\\src\\\\App.js\";\nimport React from \"react\"; // import logo from './logo.svg';\n//import * as tf from \"@tensorflow/tfjs-core\";\n\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\";\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      count: 0,\n      rcount: 0,\n      index_passed: 0,\n      rotate_passed: 0,\n      record: [],\n      ID: 0,\n      real_time_inferencing: false,\n      recording: false,\n      cam_mode: true\n    };\n    this.webcamRef = /*#__PURE__*/React.createRef(null);\n    this.canvasRef = /*#__PURE__*/React.createRef(null);\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n  }\n\n  norm(lm1, lm2) {\n    return sqrt(pow(lm1[0] - lm2[0], 2) + pow(lm1[1] - lm2[1], 2));\n  }\n\n  reset_counter() {\n    this.setState({\n      count: 0\n    });\n    this.setState({\n      rcount: 0\n    });\n  }\n\n  async runHandpose() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.read_time_inference(net);\n    }, 50);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      real_time_inferencing: true\n    });\n  }\n\n  async read_time_inference(net) {\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]); //sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n\n          let index_dist = this.norm(landmarks[4], landmarks[8]); //sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n\n          index_dist = index_dist / pawn_dist;\n\n          if (index_dist >= 0.5) {\n            this.setState({\n              index_passed: 1\n            });\n          }\n\n          if (index_dist < 0.5 && this.state.index_passed === 1) {\n            this.setState({\n              index_passed: 0\n            });\n            this.setState({\n              count: this.state.count + 1\n            });\n          }\n\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n\n          if (this.state.rotate_passed === 0) {\n            if (rotate_dist >= 0.5) this.setState({\n              rotate_passed: 1\n            });\n            if (rotate_dist <= -0.5) this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5) {\n            this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5) {\n            this.setState({\n              rotate_passed: 1\n            });\n            this.setState({\n              rcount: this.state.rcount + 1\n            });\n          } //console.log(\"passed:\", this.state.passed, \"count:\", this.state.count)\n\n\n          const ctx = this.canvasRef.current.getContext(\"2d\");\n          this.setState({\n            context: ctx\n          });\n          drawHand(hand, ctx);\n        });\n      }\n    }\n  }\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({\n      real_time_inferencing: false\n    });\n  }\n\n  async record_video() {\n    const Interval_ID = setInterval(() => {\n      this.concat_frame();\n    }, 50);\n    this.setState({\n      ID: Interval_ID\n    });\n    this.setState({\n      recording: true\n    });\n  }\n\n  async concat_frame() {\n    if (typeof this.webcamRef.current !== \"undefined\" && this.webcamRef.current !== null && this.webcamRef.current.video.readyState === 4) {\n      const image = this.webcamRef.current.getScreenshot();\n      var img = document.createElement(\"img\");\n\n      img.onload = function () {\n        this.setState({\n          record: [...this.state.record, img]\n        });\n        console.log(this.state.record, this.state.recording);\n      }.bind(this);\n\n      img.src = image;\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    var i;\n\n    for (i = 0; i < this.state.record.length; i++) {\n      const hand = await net.estimateHands(this.state.record[i]);\n      console.log(hand);\n\n      if (hand.length > 0) {\n        hand.forEach(prediction => {\n          const landmarks = prediction.landmarks;\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]); //sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n\n          let index_dist = this.norm(landmarks[4], landmarks[8]); //sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n\n          index_dist = index_dist / pawn_dist;\n\n          if (index_dist >= 0.5) {\n            this.setState({\n              index_passed: 1\n            });\n          }\n\n          if (index_dist < 0.5 && this.state.index_passed === 1) {\n            this.setState({\n              index_passed: 0\n            });\n            this.setState({\n              count: this.state.count + 1\n            });\n          }\n\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n\n          if (this.state.rotate_passed === 0) {\n            if (rotate_dist >= 0.5) this.setState({\n              rotate_passed: 1\n            });\n            if (rotate_dist <= -0.5) this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5) {\n            this.setState({\n              rotate_passed: -1\n            });\n          }\n\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5) {\n            this.setState({\n              rotate_passed: 1\n            });\n            this.setState({\n              rcount: this.state.rcount + 1\n            });\n          }\n        });\n      }\n    }\n\n    this.setState({\n      record: []\n    });\n  }\n\n  stop_record() {\n    clearInterval(this.state.ID);\n    this.inference();\n    this.setState({\n      recording: false\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: /*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"App-header\",\n        children: this.state.cam_mode ? /*#__PURE__*/_jsxDEV(\"header\", {\n          children: [/*#__PURE__*/_jsxDEV(Webcam, {\n            ref: this.webcamRef,\n            style: {\n              position: \"absolute\",\n              marginLeft: \"auto\",\n              marginRight: \"auto\",\n              left: 0,\n              right: 0,\n              textAlign: \"center\",\n              zindex: 9,\n              width: \"auto\",\n              height: \"auto\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: this.canvasRef,\n            style: {\n              position: \"absolute\",\n              marginLeft: \"auto\",\n              marginRight: \"auto\",\n              left: 0,\n              right: 0,\n              textAlign: \"center\",\n              zindex: 9,\n              width: \"auto\",\n              height: \"auto\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 15\n          }, this), this.state.real_time_inferencing ? /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.stop_real_time_inference,\n            children: \"Stopping Real Time Inference\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.runHandpose,\n            children: \"Starting Real Time Inference\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 17\n          }, this), this.state.recording ? /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.stop_record,\n            children: \"Stopping Recording\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.record_video,\n            children: \"Starting Recording\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.reset_counter,\n            children: \"Reset Counter\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            children: [\"Finger Tapping Count: \", this.state.count]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            children: [\"Rotate Count: \", this.state.rcount]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Button\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/wongh/finger/src/App.js"],"names":["React","handpose","Webcam","drawHand","sqrt","pow","App","Component","constructor","props","state","count","rcount","index_passed","rotate_passed","record","ID","real_time_inferencing","recording","cam_mode","webcamRef","createRef","canvasRef","runHandpose","bind","stop_real_time_inference","stop_record","record_video","concat_frame","inference","reset_counter","norm","lm1","lm2","setState","require","net","load","console","log","Interval_ID","setInterval","read_time_inference","current","video","readyState","videoWidth","videoHeight","width","height","hand","estimateHands","length","forEach","prediction","landmarks","pawn_dist","index_dist","rotate_dist","ctx","getContext","context","clearInterval","image","getScreenshot","img","document","createElement","onload","src","i","render","position","marginLeft","marginRight","left","right","textAlign","zindex"],"mappings":"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","sourcesContent":["import React from \"react\";\n// import logo from './logo.svg';\n//import * as tf from \"@tensorflow/tfjs-core\";\nimport * as handpose from \"@tensorflow-models/handpose\";\nimport Webcam from \"react-webcam\";\nimport \"./App.css\";\nimport { drawHand } from \"./utilities\";\nimport { sqrt, pow } from \"mathjs\"\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      count : 0,\n      rcount : 0,\n      index_passed : 0,\n      rotate_passed : 0,\n      record : [],\n      ID : 0,\n      real_time_inferencing:false,\n      recording:false,\n      cam_mode:true,\n    };\n    this.webcamRef = React.createRef(null);\n    this.canvasRef = React.createRef(null);\n    this.runHandpose = this.runHandpose.bind(this);\n    this.stop_real_time_inference = this.stop_real_time_inference.bind(this);\n    this.stop_record = this.stop_record.bind(this);\n    this.record_video = this.record_video.bind(this);\n    this.concat_frame = this.concat_frame.bind(this);\n    this.inference = this.inference.bind(this);\n    this.reset_counter = this.reset_counter.bind(this);\n  }\n\n  norm(lm1, lm2){\n    return sqrt(pow(lm1[0]-lm2[0], 2)+pow(lm1[1]-lm2[1], 2))\n  }\n\n  reset_counter(){\n    this.setState({count:0});\n    this.setState({rcount:0});\n  }\n\n  async runHandpose() {    \n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    const Interval_ID = setInterval(() => {\n      this.read_time_inference(net);\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({real_time_inferencing:true});\n  };\n\n  async read_time_inference(net) {\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const video = this.webcamRef.current.video;\n      const videoWidth = this.webcamRef.current.video.videoWidth;\n      const videoHeight = this.webcamRef.current.video.videoHeight;\n      this.webcamRef.current.video.width = videoWidth;\n      this.webcamRef.current.video.height = videoHeight;\n      this.canvasRef.current.width = videoWidth;\n      this.canvasRef.current.height = videoHeight;\n      const hand = await net.estimateHands(video);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]); //sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n          let index_dist = this.norm(landmarks[4], landmarks[8]); //sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n          index_dist = index_dist/pawn_dist          \n          if (index_dist >= 0.5){this.setState({index_passed:1})}\n          if (index_dist < 0.5 && this.state.index_passed === 1){\n            this.setState({index_passed:0});\n            this.setState({count:this.state.count+1});\n          }\n\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n          if (this.state.rotate_passed === 0){\n            if (rotate_dist >= 0.5) this.setState({rotate_passed:1});\n            if (rotate_dist <= -0.5) this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5){\n            this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5){\n            this.setState({rotate_passed:1});\n            this.setState({rcount:this.state.rcount+1});\n          }\n\n          //console.log(\"passed:\", this.state.passed, \"count:\", this.state.count)\n          const ctx = this.canvasRef.current.getContext(\"2d\");\n          this.setState({context:ctx});\n          drawHand(hand, ctx);\n        });\n      }      \n    }\n  };\n\n  stop_real_time_inference() {\n    clearInterval(this.state.ID);\n    this.setState({real_time_inferencing:false});\n  }\n\n  async record_video(){    \n    const Interval_ID = setInterval(() => {\n      this.concat_frame();\n    }, 50);\n    this.setState({ID:Interval_ID});\n    this.setState({recording:true});\n  }\n\n  async concat_frame() {\n    if (\n      typeof this.webcamRef.current !== \"undefined\" &&\n      this.webcamRef.current !== null &&\n      this.webcamRef.current.video.readyState === 4\n    ) {\n      const image = this.webcamRef.current.getScreenshot();      \n      var img = document.createElement(\"img\");\n      img.onload = function(){\n        this.setState({record:[...this.state.record, img]});\n        console.log(this.state.record, this.state.recording);\n      }.bind(this)\n      img.src = image;\n    }\n  }\n\n  async inference() {\n    require('@tensorflow/tfjs-backend-webgl');\n    const net = await handpose.load();\n    console.log(\"Handpose model loaded.\");\n    var i;\n    for (i = 0; i<this.state.record.length; i++){\n      const hand = await net.estimateHands(this.state.record[i]);\n      console.log(hand);\n      if (hand.length > 0){\n        hand.forEach((prediction) => {\n          const landmarks = prediction.landmarks\n\n          let pawn_dist = this.norm(landmarks[0], landmarks[2]); //sqrt(pow(landmarks[0][0]-landmarks[2][0], 2)+pow(landmarks[0][1]-landmarks[2][1], 2))\n          let index_dist = this.norm(landmarks[4], landmarks[8]); //sqrt(pow(landmarks[8][0]-landmarks[4][0], 2)+pow(landmarks[8][1]-landmarks[4][1], 2))\n          index_dist = index_dist/pawn_dist          \n          if (index_dist >= 0.5){this.setState({index_passed:1})}\n          if (index_dist < 0.5 && this.state.index_passed === 1){\n            this.setState({index_passed:0});\n            this.setState({count:this.state.count+1});\n          }\n\n          let rotate_dist = (landmarks[2][0] - landmarks[17][0]) / pawn_dist;\n          if (this.state.rotate_passed === 0){\n            if (rotate_dist >= 0.5) this.setState({rotate_passed:1});\n            if (rotate_dist <= -0.5) this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === 1 && rotate_dist <= -0.5){\n            this.setState({rotate_passed:-1});\n          }\n          if (this.state.rotate_passed === -1 && rotate_dist >= 0.5){\n            this.setState({rotate_passed:1});\n            this.setState({rcount:this.state.rcount+1});\n          }\n        });\n      }\n    }\n    this.setState({record:[]});\n  }\n\n  stop_record() {\n    clearInterval(this.state.ID);\n    this.inference();\n    this.setState({recording:false});\n  }\n\n  render(){\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          {this.state.cam_mode ? (\n            <header>\n              <Webcam\n              ref={this.webcamRef}\n              style={{\n                position: \"absolute\",\n                marginLeft: \"auto\",\n                marginRight: \"auto\",\n                left: 0,\n                right: 0,\n                textAlign: \"center\",\n                zindex: 9,\n                width: \"auto\",\n                height: \"auto\",\n              }}\n              />\n              <canvas\n                ref={this.canvasRef}\n                style={{\n                  position: \"absolute\",\n                  marginLeft: \"auto\",\n                  marginRight: \"auto\",\n                  left: 0,\n                  right: 0,\n                  textAlign: \"center\",\n                  zindex: 9,\n                  width: \"auto\",\n                  height: \"auto\",\n                }}\n              />\n              {this.state.real_time_inferencing ? (\n                <button onClick={this.stop_real_time_inference}>Stopping Real Time Inference</button>\n              ) : (\n                <button onClick={this.runHandpose}>Starting Real Time Inference</button>\n              )}\n              {this.state.recording ? (\n                <button onClick={this.stop_record}>Stopping Recording</button>\n              ) : (\n                <button onClick={this.record_video}>Starting Recording</button>\n              )}\n              <button onClick={this.reset_counter}>Reset Counter</button>          \n              <h4>Finger Tapping Count: {this.state.count}</h4>\n              <h4>Rotate Count: {this.state.rcount}</h4>\n            </header>\n          ) : (\n            <h4>Button</h4>\n          )}\n          </header>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}